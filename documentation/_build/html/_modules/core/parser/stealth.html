

<!DOCTYPE html>
<html class="writer-html5" lang="ru" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>core.parser.stealth &mdash; –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Audotex Parser 1.0</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=9ca2116e"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/translations.js?v=cd1d70c9"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="–ê–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å" href="../../../genindex.html" />
    <link rel="search" title="–ü–æ–∏—Å–∫" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Audotex Parser
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏" aria-label="–ü–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="–ú–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏">
              <p class="caption" role="heading"><span class="caption-text">–ú–æ–¥—É–ª–∏:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/auth.html">–ú–æ–¥—É–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (auth)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/database.html">–ú–æ–¥—É–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (database)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/parser.html">–ú–æ–¥—É–ª—å –ø–∞—Ä—Å–µ—Ä–∞ (parser)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/queue.html">–ú–æ–¥—É–ª—å –æ—á–µ—Ä–µ–¥–∏ (queue)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/security.html">–ú–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (security)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="–ú–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Audotex Parser</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">–ö–æ–¥ –º–æ–¥—É–ª—è</a></li>
      <li class="breadcrumb-item active">core.parser.stealth</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ core.parser.stealth</h1><div class="highlight"><pre>
<span></span><span class="c1"># –ú–æ–¥—É–ª—å –¥–ª—è stealth-–º–µ—Ç–æ–¥–æ–≤ –æ–±—Ö–æ–¥–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏ –±–æ—Ç–∞</span>
<span class="c1"># –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ç–µ—Ö–Ω–∏–∫–∞—Ö SeleniumBase UC Mode –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–∞—Ö –æ–±—Ö–æ–¥–∞ –±–æ—Ç-–¥–µ—Ç–µ–∫—Ç–∞</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.remote.webdriver</span><span class="w"> </span><span class="kn">import</span> <span class="n">WebDriver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.by</span><span class="w"> </span><span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.support.ui</span><span class="w"> </span><span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.support</span><span class="w"> </span><span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.common.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TimeoutException</span><span class="p">,</span> <span class="n">WebDriverException</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="apply_advanced_stealth_masking">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.stealth.apply_advanced_stealth_masking">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">apply_advanced_stealth_masking</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">WebDriver</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ headless —Ä–µ–∂–∏–º–∞</span>
<span class="sd">    –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–∞—Ö –æ–±—Ö–æ–¥–∞ –±–æ—Ç-–¥–µ—Ç–µ–∫—Ç–∞</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤</span>
<span class="s2">            function safeDefineProperty(obj, prop, descriptor) {</span>
<span class="s2">                try {</span>
<span class="s2">                    const existingDescriptor = Object.getOwnPropertyDescriptor(obj, prop);</span>
<span class="s2">                    if (existingDescriptor &amp;&amp; !existingDescriptor.configurable) {</span>
<span class="s2">                        return false; // –°–≤–æ–π—Å—Ç–≤–æ –Ω–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ–µ</span>
<span class="s2">                    }</span>
<span class="s2">                    Object.defineProperty(obj, prop, descriptor);</span>
<span class="s2">                    return true;</span>
<span class="s2">                } catch (e) {</span>
<span class="s2">                    return false;</span>
<span class="s2">                }</span>
<span class="s2">            }</span>
<span class="s2">            </span>
<span class="s2">            // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ webdriver</span>
<span class="s2">            try {</span>
<span class="s2">                const originalQuery = window.navigator.permissions.query;</span>
<span class="s2">                window.navigator.permissions.query = (parameters) =&gt; (</span>
<span class="s2">                    parameters.name === &#39;notifications&#39; ?</span>
<span class="s2">                        Promise.resolve({ state: Notification.permission }) :</span>
<span class="s2">                        originalQuery(parameters)</span>
<span class="s2">                );</span>
<span class="s2">            } catch (e) {</span>
<span class="s2">                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏</span>
<span class="s2">            }</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º webdriver</span>
<span class="s2">            safeDefineProperty(navigator, &#39;webdriver&#39;, {</span>
<span class="s2">                get: () =&gt; undefined,</span>
<span class="s2">                configurable: true</span>
<span class="s2">            });</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º chrome runtime</span>
<span class="s2">            if (window.chrome) {</span>
<span class="s2">                try {</span>
<span class="s2">                    window.chrome = {</span>
<span class="s2">                        runtime: </span><span class="si">{}</span><span class="s2">,</span>
<span class="s2">                        loadTimes: function() </span><span class="si">{}</span><span class="s2">,</span>
<span class="s2">                        csi: function() </span><span class="si">{}</span><span class="s2">,</span>
<span class="s2">                        app: </span><span class="si">{}</span>
<span class="s2">                    };</span>
<span class="s2">                } catch (e) {</span>
<span class="s2">                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏</span>
<span class="s2">                }</span>
<span class="s2">            }</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º permissions</span>
<span class="s2">            try {</span>
<span class="s2">                const originalPermissions = navigator.permissions;</span>
<span class="s2">                navigator.permissions = {</span>
<span class="s2">                    ...originalPermissions,</span>
<span class="s2">                    query: (parameters) =&gt; {</span>
<span class="s2">                        if (parameters.name === &#39;notifications&#39;) {</span>
<span class="s2">                            return Promise.resolve({ state: &#39;granted&#39; });</span>
<span class="s2">                        }</span>
<span class="s2">                        return originalPermissions.query(parameters);</span>
<span class="s2">                    }</span>
<span class="s2">                };</span>
<span class="s2">            } catch (e) {</span>
<span class="s2">                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏</span>
<span class="s2">            }</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º plugins</span>
<span class="s2">            safeDefineProperty(navigator, &#39;plugins&#39;, {</span>
<span class="s2">                get: () =&gt; [1, 2, 3, 4, 5],</span>
<span class="s2">                configurable: true</span>
<span class="s2">            });</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º languages</span>
<span class="s2">            safeDefineProperty(navigator, &#39;languages&#39;, {</span>
<span class="s2">                get: () =&gt; [&#39;ru-RU&#39;, &#39;ru&#39;, &#39;en-US&#39;, &#39;en&#39;],</span>
<span class="s2">                configurable: true</span>
<span class="s2">            });</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º connection</span>
<span class="s2">            safeDefineProperty(navigator, &#39;connection&#39;, {</span>
<span class="s2">                get: () =&gt; ({</span>
<span class="s2">                    effectiveType: &#39;4g&#39;,</span>
<span class="s2">                    rtt: 50,</span>
<span class="s2">                    downlink: 10,</span>
<span class="s2">                    saveData: false,</span>
<span class="s2">                }),</span>
<span class="s2">                configurable: true</span>
<span class="s2">            });</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º hardwareConcurrency</span>
<span class="s2">            safeDefineProperty(navigator, &#39;hardwareConcurrency&#39;, {</span>
<span class="s2">                get: () =&gt; 8,</span>
<span class="s2">                configurable: true</span>
<span class="s2">            });</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º deviceMemory</span>
<span class="s2">            safeDefineProperty(navigator, &#39;deviceMemory&#39;, {</span>
<span class="s2">                get: () =&gt; 8,</span>
<span class="s2">                configurable: true</span>
<span class="s2">            });</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º userAgent</span>
<span class="s2">            try {</span>
<span class="s2">                const originalUserAgent = navigator.userAgent;</span>
<span class="s2">                </span>
<span class="s2">                // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ–±—Ö–æ–¥–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏</span>
<span class="s2">                safeDefineProperty(navigator, &#39;maxTouchPoints&#39;, {</span>
<span class="s2">                    get: () =&gt; 0,</span>
<span class="s2">                    configurable: true</span>
<span class="s2">                });</span>
<span class="s2">                </span>
<span class="s2">                safeDefineProperty(navigator, &#39;vendor&#39;, {</span>
<span class="s2">                    get: () =&gt; &#39;Google Inc.&#39;,</span>
<span class="s2">                    configurable: true</span>
<span class="s2">                });</span>
<span class="s2">                </span>
<span class="s2">                safeDefineProperty(navigator, &#39;platform&#39;, {</span>
<span class="s2">                    get: () =&gt; &#39;Win32&#39;,</span>
<span class="s2">                    configurable: true</span>
<span class="s2">                });</span>
<span class="s2">                </span>
<span class="s2">                // –ú–∞—Å–∫–∏—Ä—É–µ–º WebGL</span>
<span class="s2">                try {</span>
<span class="s2">                    const getParameter = WebGLRenderingContext.prototype.getParameter;</span>
<span class="s2">                    WebGLRenderingContext.prototype.getParameter = function(parameter) {</span>
<span class="s2">                        if (parameter === 37445) {</span>
<span class="s2">                            return &#39;Intel Inc.&#39;;</span>
<span class="s2">                        }</span>
<span class="s2">                        if (parameter === 37446) {</span>
<span class="s2">                            return &#39;Intel(R) Iris(TM) Graphics 6100&#39;;</span>
<span class="s2">                        }</span>
<span class="s2">                        return getParameter.call(this, parameter);</span>
<span class="s2">                    };</span>
<span class="s2">                } catch (e) {</span>
<span class="s2">                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ WebGL</span>
<span class="s2">                }</span>
<span class="s2">                </span>
<span class="s2">                // –ú–∞—Å–∫–∏—Ä—É–µ–º Canvas fingerprinting</span>
<span class="s2">                try {</span>
<span class="s2">                    const originalGetContext = HTMLCanvasElement.prototype.getContext;</span>
<span class="s2">                    HTMLCanvasElement.prototype.getContext = function(type, ...args) {</span>
<span class="s2">                        const context = originalGetContext.call(this, type, ...args);</span>
<span class="s2">                        if (type === &#39;2d&#39;) {</span>
<span class="s2">                            const originalFillText = context.fillText;</span>
<span class="s2">                            context.fillText = function(...args) {</span>
<span class="s2">                                return originalFillText.apply(this, args);</span>
<span class="s2">                            };</span>
<span class="s2">                        }</span>
<span class="s2">                        return context;</span>
<span class="s2">                    };</span>
<span class="s2">                } catch (e) {</span>
<span class="s2">                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ Canvas</span>
<span class="s2">                }</span>
<span class="s2">                </span>
<span class="s2">                // –ú–∞—Å–∫–∏—Ä—É–µ–º Audio fingerprinting</span>
<span class="s2">                try {</span>
<span class="s2">                    const originalGetChannelData = AudioBuffer.prototype.getChannelData;</span>
<span class="s2">                    AudioBuffer.prototype.getChannelData = function(channel) {</span>
<span class="s2">                        const data = originalGetChannelData.call(this, channel);</span>
<span class="s2">                        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏</span>
<span class="s2">                        for (let i = 0; i &lt; data.length; i += 100) {</span>
<span class="s2">                            data[i] += Math.random() * 0.0001;</span>
<span class="s2">                        }</span>
<span class="s2">                        return data;</span>
<span class="s2">                    };</span>
<span class="s2">                } catch (e) {</span>
<span class="s2">                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ Audio</span>
<span class="s2">                }</span>
<span class="s2">                Object.defineProperty(navigator, &#39;userAgent&#39;, {</span>
<span class="s2">                    get: () =&gt; originalUserAgent.replace(&#39;HeadlessChrome&#39;, &#39;Chrome&#39;),</span>
<span class="s2">                });</span>
<span class="s2">            } catch (e) {</span>
<span class="s2">                // –°–≤–æ–π—Å—Ç–≤–æ —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º</span>
<span class="s2">            }</span>
<span class="s2">            </span>
<span class="s2">            // –£–¥–∞–ª—è–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏</span>
<span class="s2">            delete window.cdc_adoQpoasnfa76pfcZLmcfl_Array;</span>
<span class="s2">            delete window.cdc_adoQpoasnfa76pfcZLmcfl_Promise;</span>
<span class="s2">            delete window.cdc_adoQpoasnfa76pfcZLmcfl_Symbol;</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º screen —Å–≤–æ–π—Å—Ç–≤–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ</span>
<span class="s2">            safeDefineProperty(screen, &#39;width&#39;, { get: () =&gt; 1920 });</span>
<span class="s2">            safeDefineProperty(screen, &#39;height&#39;, { get: () =&gt; 1080 });</span>
<span class="s2">            safeDefineProperty(screen, &#39;availWidth&#39;, { get: () =&gt; 1920 });</span>
<span class="s2">            safeDefineProperty(screen, &#39;availHeight&#39;, { get: () =&gt; 1040 });</span>
<span class="s2">            safeDefineProperty(screen, &#39;colorDepth&#39;, { get: () =&gt; 24 });</span>
<span class="s2">            safeDefineProperty(screen, &#39;pixelDepth&#39;, { get: () =&gt; 24 });</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º window —Å–≤–æ–π—Å—Ç–≤–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ</span>
<span class="s2">            safeDefineProperty(window, &#39;outerWidth&#39;, { get: () =&gt; 1920 });</span>
<span class="s2">            safeDefineProperty(window, &#39;outerHeight&#39;, { get: () =&gt; 1080 });</span>
<span class="s2">            safeDefineProperty(window, &#39;innerWidth&#39;, { get: () =&gt; 1920 });</span>
<span class="s2">            safeDefineProperty(window, &#39;innerHeight&#39;, { get: () =&gt; 937 });</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º devicePixelRatio –±–µ–∑–æ–ø–∞—Å–Ω–æ</span>
<span class="s2">            safeDefineProperty(window, &#39;devicePixelRatio&#39;, { get: () =&gt; 1 });</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ headless —Ä–µ–∂–∏–º–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞&quot;</span><span class="p">)</span>
        
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="apply_headless_masking">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.stealth.apply_headless_masking">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">apply_headless_masking</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">WebDriver</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ü—Ä–∏–º–µ–Ω—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ headless —Ä–µ–∂–∏–º–∞</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º headless —Ä–µ–∂–∏–º</span>
<span class="s2">            try {</span>
<span class="s2">                Object.defineProperty(navigator, &#39;webdriver&#39;, {</span>
<span class="s2">                    get: () =&gt; undefined,</span>
<span class="s2">                });</span>
<span class="s2">            } catch (e) {</span>
<span class="s2">                // –°–≤–æ–π—Å—Ç–≤–æ —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º</span>
<span class="s2">            }</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º chrome</span>
<span class="s2">            try {</span>
<span class="s2">                Object.defineProperty(navigator, &#39;languages&#39;, {</span>
<span class="s2">                    get: () =&gt; [&#39;ru-RU&#39;, &#39;ru&#39;, &#39;en-US&#39;, &#39;en&#39;],</span>
<span class="s2">                });</span>
<span class="s2">            } catch (e) {</span>
<span class="s2">                // –°–≤–æ–π—Å—Ç–≤–æ —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º</span>
<span class="s2">            }</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º permissions</span>
<span class="s2">            try {</span>
<span class="s2">                Object.defineProperty(navigator, &#39;permissions&#39;, {</span>
<span class="s2">                    get: () =&gt; ({</span>
<span class="s2">                        query: () =&gt; Promise.resolve({ state: &#39;granted&#39; }),</span>
<span class="s2">                    }),</span>
<span class="s2">                });</span>
<span class="s2">            } catch (e) {</span>
<span class="s2">                // –°–≤–æ–π—Å—Ç–≤–æ —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º</span>
<span class="s2">            }</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º plugins</span>
<span class="s2">            try {</span>
<span class="s2">                Object.defineProperty(navigator, &#39;plugins&#39;, {</span>
<span class="s2">                    get: () =&gt; [1, 2, 3, 4, 5],</span>
<span class="s2">                });</span>
<span class="s2">            } catch (e) {</span>
<span class="s2">                // –°–≤–æ–π—Å—Ç–≤–æ —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º</span>
<span class="s2">            }</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º connection</span>
<span class="s2">            try {</span>
<span class="s2">                Object.defineProperty(navigator, &#39;connection&#39;, {</span>
<span class="s2">                    get: () =&gt; ({</span>
<span class="s2">                        effectiveType: &#39;4g&#39;,</span>
<span class="s2">                        rtt: 50,</span>
<span class="s2">                        downlink: 10,</span>
<span class="s2">                    }),</span>
<span class="s2">                });</span>
<span class="s2">            } catch (e) {</span>
<span class="s2">                // –°–≤–æ–π—Å—Ç–≤–æ —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º</span>
<span class="s2">            }</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º hardwareConcurrency</span>
<span class="s2">            try {</span>
<span class="s2">                Object.defineProperty(navigator, &#39;hardwareConcurrency&#39;, {</span>
<span class="s2">                    get: () =&gt; 8,</span>
<span class="s2">                });</span>
<span class="s2">            } catch (e) {</span>
<span class="s2">                // –°–≤–æ–π—Å—Ç–≤–æ —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º</span>
<span class="s2">            }</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º deviceMemory</span>
<span class="s2">            try {</span>
<span class="s2">                Object.defineProperty(navigator, &#39;deviceMemory&#39;, {</span>
<span class="s2">                    get: () =&gt; 8,</span>
<span class="s2">                });</span>
<span class="s2">            } catch (e) {</span>
<span class="s2">                // –°–≤–æ–π—Å—Ç–≤–æ —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º</span>
<span class="s2">            }</span>
<span class="s2">            </span>
<span class="s2">            // –£–¥–∞–ª—è–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏</span>
<span class="s2">            delete window.cdc_adoQpoasnfa76pfcZLmcfl_Array;</span>
<span class="s2">            delete window.cdc_adoQpoasnfa76pfcZLmcfl_Promise;</span>
<span class="s2">            delete window.cdc_adoQpoasnfa76pfcZLmcfl_Symbol;</span>
<span class="s2">            </span>
<span class="s2">            // –ú–∞—Å–∫–∏—Ä—É–µ–º screen —Å–≤–æ–π—Å—Ç–≤–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é safeDefineProperty)</span>
<span class="s2">            if (typeof safeDefineProperty === &#39;function&#39;) {</span>
<span class="s2">                safeDefineProperty(screen, &#39;width&#39;, { get: () =&gt; 1920 });</span>
<span class="s2">                safeDefineProperty(screen, &#39;height&#39;, { get: () =&gt; 1080 });</span>
<span class="s2">                safeDefineProperty(screen, &#39;availWidth&#39;, { get: () =&gt; 1920 });</span>
<span class="s2">                safeDefineProperty(screen, &#39;availHeight&#39;, { get: () =&gt; 1040 });</span>
<span class="s2">                </span>
<span class="s2">                // –ú–∞—Å–∫–∏—Ä—É–µ–º window —Å–≤–æ–π—Å—Ç–≤–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ</span>
<span class="s2">                safeDefineProperty(window, &#39;outerWidth&#39;, { get: () =&gt; 1920 });</span>
<span class="s2">                safeDefineProperty(window, &#39;outerHeight&#39;, { get: () =&gt; 1080 });</span>
<span class="s2">                safeDefineProperty(window, &#39;innerWidth&#39;, { get: () =&gt; 1920 });</span>
<span class="s2">                safeDefineProperty(window, &#39;innerHeight&#39;, { get: () =&gt; 937 });</span>
<span class="s2">            }</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ headless —Ä–µ–∂–∏–º–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞&quot;</span><span class="p">)</span>
        
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ headless: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="stealth_open_url">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.stealth.stealth_open_url">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">stealth_open_url</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">WebDriver</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">reconnect_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –°–∫—Ä—ã—Ç–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ URL —Å –º–µ—Ç–æ–¥–∞–º–∏ –æ–±—Ö–æ–¥–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîí –°–∫—Ä—ã—Ç–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –º–∞—Å–∫–∏—Ä–æ–≤–∫—É –¥–ª—è headless —Ä–µ–∂–∏–º–∞ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç–æ–π</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">apply_advanced_stealth_masking</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">stealth_error</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ stealth –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏: </span><span class="si">{</span><span class="n">stealth_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–∂–µ –µ—Å–ª–∏ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å</span>
        
        <span class="c1"># –û—Ç–∫—Ä—ã–≤–∞–µ–º URL</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        
        <span class="c1"># –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ DOM –º–æ–¥–µ–ª–∏</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;return document.readyState === &#39;complete&#39;&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="c1"># –ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞</span>
        <span class="k">if</span> <span class="n">reconnect_time</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">reconnect_time</span><span class="p">)</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;‚úÖ URL —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫—Ä—ã—Ç —Å–∫—Ä—ã—Ç–Ω–æ&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
        
    <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å –∑–∞ 10 —Å–µ–∫—É–Ω–¥: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä—ã—Ç–Ω–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ URL: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="stealth_click">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.stealth.stealth_click">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">stealth_click</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">WebDriver</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">use_actions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –°–∫—Ä—ã—Ç–Ω—ã–π –∫–ª–∏–∫ —Å –æ–±—Ö–æ–¥–æ–º –¥–µ—Ç–µ–∫—Ü–∏–∏</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_perform_click</span><span class="p">():</span>
        <span class="c1"># –ñ–¥–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å WebDriverWait –±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥ —Ç–∞–π–º–∞—É—Ç–∞</span>
        <span class="n">element</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="n">selector</span><span class="p">))</span>
        <span class="p">)</span>
        
        <span class="c1"># –î–æ–±–∞–≤–ª—è–µ–º —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ</span>
        <span class="n">add_stealth_behavior</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">use_actions</span><span class="p">:</span>
            <span class="c1"># –ò—Å–ø–æ–ª—å–∑—É–µ–º ActionChains –¥–ª—è –±–æ–ª–µ–µ —á–µ–ª–æ–≤–µ—á–Ω–æ–≥–æ –∫–ª–∏–∫–∞</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.action_chains</span><span class="w"> </span><span class="kn">import</span> <span class="n">ActionChains</span>
            <span class="n">actions</span> <span class="o">=</span> <span class="n">ActionChains</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
            <span class="n">actions</span><span class="o">.</span><span class="n">move_to_element</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
            <span class="n">actions</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="n">actions</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># –û–±—ã—á–Ω—ã–π –∫–ª–∏–∫ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
            <span class="n">element</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="kc">True</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîí –°–∫—Ä—ã—Ç–Ω—ã–π –∫–ª–∏–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">safe_stealth_execution</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;–∫–ª–∏–∫ –ø–æ </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">_perform_click</span><span class="p">)</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;‚úÖ –°–∫—Ä—ã—Ç–Ω—ã–π –∫–ª–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
        
    <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –≠–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –∫–ª–∏–∫–∞: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä—ã—Ç–Ω–æ–º –∫–ª–∏–∫–µ: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="add_stealth_behavior">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.stealth.add_stealth_behavior">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_stealth_behavior</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">WebDriver</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –î–æ–±–∞–≤–ª—è–µ—Ç stealth-–ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –æ–±—Ö–æ–¥–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># –°–ª—É—á–∞–π–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–∫–Ω–∞</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">window_size</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">get_window_size</span><span class="p">()</span>
            <span class="n">max_x</span> <span class="o">=</span> <span class="n">window_size</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">100</span>
            <span class="n">max_y</span> <span class="o">=</span> <span class="n">window_size</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">100</span>
            
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_x</span><span class="p">))</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_y</span><span class="p">))</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;window.scrollTo(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">);&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ –≤ stealth: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># –°–ª—É—á–∞–π–Ω—ã–π —Å–∫—Ä–æ–ª–ª</span>
        <span class="n">scroll_amount</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;window.scrollBy(0, </span><span class="si">{</span><span class="n">scroll_amount</span><span class="si">}</span><span class="s2">);&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;–î–æ–±–∞–≤–ª–µ–Ω–æ stealth-–ø–æ–≤–µ–¥–µ–Ω–∏–µ&quot;</span><span class="p">)</span>
        
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ stealth-–ø–æ–≤–µ–¥–µ–Ω–∏—è: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="check_stealth_detection">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.stealth.check_stealth_detection">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">check_stealth_detection</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">WebDriver</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ stealth-–º–µ—Ç–æ–¥–æ–≤</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</span>
        <span class="n">page_source</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">detection_indicators</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;gethandleverifier&quot;</span><span class="p">,</span>
            <span class="s2">&quot;white screen&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bot detected&quot;</span><span class="p">,</span>
            <span class="s2">&quot;automation detected&quot;</span><span class="p">,</span>
            <span class="s2">&quot;captcha&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cloudflare&quot;</span><span class="p">,</span>
            <span class="s2">&quot;access denied&quot;</span><span class="p">,</span>
            <span class="s2">&quot;blocked&quot;</span><span class="p">,</span>
            <span class="s2">&quot;security check&quot;</span><span class="p">,</span>
            <span class="s2">&quot;verify you are human&quot;</span><span class="p">,</span>
            <span class="s2">&quot;please wait&quot;</span>
        <span class="p">]</span>
        
        <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">detection_indicators</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">page_source</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–µ—Ç–µ–∫—Ü–∏–∏: </span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
        
        <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º JavaScript –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏</span>
        <span class="n">js_detection_checks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;return navigator.webdriver&quot;</span><span class="p">,</span>
            <span class="s2">&quot;return window.chrome &amp;&amp; window.chrome.runtime&quot;</span><span class="p">,</span>
            <span class="s2">&quot;return navigator.plugins.length === 0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;return navigator.languages.length === 0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;return !navigator.connection&quot;</span><span class="p">,</span>
            <span class="s2">&quot;return !navigator.hardwareConcurrency&quot;</span><span class="p">,</span>
            <span class="s2">&quot;return !navigator.deviceMemory&quot;</span><span class="p">,</span>
            <span class="s2">&quot;return !navigator.maxTouchPoints&quot;</span><span class="p">,</span>
            <span class="s2">&quot;return !navigator.vendor&quot;</span><span class="p">,</span>
            <span class="s2">&quot;return !navigator.platform&quot;</span>
        <span class="p">]</span>
        
        <span class="n">detection_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">check</span> <span class="ow">in</span> <span class="n">js_detection_checks</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">check</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">detection_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ JavaScript –¥–µ—Ç–µ–∫—Ü–∏—è: </span><span class="si">{</span><span class="n">check</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">continue</span>
        
        <span class="k">if</span> <span class="n">detection_count</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ </span><span class="si">{</span><span class="n">detection_count</span><span class="si">}</span><span class="s2"> –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ JavaScript –¥–µ—Ç–µ–∫—Ü–∏–∏&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;‚úÖ –î–µ—Ç–µ–∫—Ü–∏—è –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
        
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ stealth-–¥–µ—Ç–µ–∫—Ü–∏–∏: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="restore_stealth_masking">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.stealth.restore_stealth_masking">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">restore_stealth_masking</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">WebDriver</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç stealth –º–∞—Å–∫–∏—Ä–æ–≤–∫—É –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;üîÑ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º stealth –º–∞—Å–∫–∏—Ä–æ–≤–∫—É&quot;</span><span class="p">)</span>
        
        <span class="c1"># –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –º–∞—Å–∫–∏—Ä–æ–≤–∫—É</span>
        <span class="n">apply_advanced_stealth_masking</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
        
        <span class="c1"># –î–æ–±–∞–≤–ª—è–µ–º —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ</span>
        <span class="n">add_stealth_behavior</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
        
        <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
        <span class="k">if</span> <span class="n">check_stealth_detection</span><span class="p">(</span><span class="n">driver</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å stealth –º–∞—Å–∫–∏—Ä–æ–≤–∫—É&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;‚úÖ Stealth –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
        
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ stealth –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="safe_stealth_execution">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.stealth.safe_stealth_execution">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">safe_stealth_execution</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">WebDriver</span><span class="p">,</span> <span class="n">operation_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">operation_func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ stealth –æ–ø–µ—Ä–∞—Ü–∏–π —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîí –ü–æ–ø—ã—Ç–∫–∞ </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">operation_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">operation_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ </span><span class="si">{</span><span class="n">operation_name</span><span class="si">}</span><span class="s2"> –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è –û—à–∏–±–∫–∞ –≤ </span><span class="si">{</span><span class="n">operation_name</span><span class="si">}</span><span class="s2"> (–ø–æ–ø—ã—Ç–∫–∞ </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># –ü—Ä–∏–º–µ–Ω—è–µ–º –±–∞–∑–æ–≤—É—é –º–∞—Å–∫–∏—Ä–æ–≤–∫—É –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">apply_headless_masking</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">mask_error</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –º–∞—Å–∫–∏—Ä–æ–≤–∫–µ: </span><span class="si">{</span><span class="n">mask_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå </span><span class="si">{</span><span class="n">operation_name</span><span class="si">}</span><span class="s2"> –Ω–µ —É–¥–∞–ª–∞—Å—å –ø–æ—Å–ª–µ </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> –ø–æ–ø—ã—Ç–æ–∫&quot;</span><span class="p">)</span>
                <span class="k">raise</span></div>



<div class="viewcode-block" id="handle_stealth_detection">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.stealth.handle_stealth_detection">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">handle_stealth_detection</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">WebDriver</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–µ—Ç–µ–∫—Ü–∏—é stealth-–º–µ—Ç–æ–¥–æ–≤ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;üö® –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º stealth-–¥–µ—Ç–µ–∫—Ü–∏—é...&quot;</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.actions</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_extended_human_behavior</span>
        <span class="n">add_extended_human_behavior</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">total_delay</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span>
        
        <span class="c1"># –ü—Ä–æ–±—É–µ–º –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</span>
        <span class="k">if</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        
        <span class="c1"># –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ DOM –º–æ–¥–µ–ª–∏</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;return document.readyState === &#39;complete&#39;&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="c1"># –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Å–∫–∏—Ä–æ–≤–∫—É headless —Ä–µ–∂–∏–º–∞</span>
        <span class="n">apply_advanced_stealth_masking</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
        <span class="n">add_stealth_behavior</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
        
        <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–Ω–æ–≤–∞</span>
        <span class="k">if</span> <span class="n">check_stealth_detection</span><span class="p">(</span><span class="n">driver</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;üö® –î–µ—Ç–µ–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;‚úÖ Stealth-–¥–µ—Ç–µ–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
        
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ stealth-–¥–µ—Ç–µ–∫—Ü–∏–∏: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="stealth_type">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.stealth.stealth_type">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">stealth_type</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">WebDriver</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –°–∫—Ä—ã—Ç–Ω—ã–π –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ —Å —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–º–∏ –ø–∞—É–∑–∞–º–∏</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîí –°–∫—Ä—ã—Ç–Ω—ã–π –≤–≤–æ–¥ –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># –ñ–¥–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å WebDriverWait –±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥ —Ç–∞–π–º–∞—É—Ç–∞</span>
        <span class="n">element</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="n">selector</span><span class="p">))</span>
        <span class="p">)</span>
        
        <span class="c1"># –û—á–∏—â–∞–µ–º –ø–æ–ª–µ</span>
        <span class="n">element</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">))</span>
        
        <span class="c1"># –í–≤–æ–¥–∏–º —Ç–µ–∫—Å—Ç –ø–æ—Å–∏–º–≤–æ–ª—å–Ω–æ —Å —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–º–∏ –ø–∞—É–∑–∞–º–∏</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">element</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">))</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;‚úÖ –°–∫—Ä—ã—Ç–Ω—ã–π –≤–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
        
    <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –≠–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –≤–≤–æ–¥–∞: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä—ã—Ç–Ω–æ–º –≤–≤–æ–¥–µ: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="stealth_wait_for_element">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.stealth.stealth_wait_for_element">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">stealth_wait_for_element</span><span class="p">(</span><span class="n">driver</span><span class="p">:</span> <span class="n">WebDriver</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –°–∫—Ä—ã—Ç–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–µ—Ç–µ–∫—Ü–∏–∏</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîí –°–∫—Ä—ã—Ç–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –º–∞—Å–∫–∏—Ä–æ–≤–∫—É headless —Ä–µ–∂–∏–º–∞</span>
        <span class="n">apply_advanced_stealth_masking</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
        
        <span class="c1"># –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>
        
        <span class="c1"># –ñ–¥–µ–º DOM –º–æ–¥–µ–ª—å —Å WebDriverWait –±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥ —Ç–∞–π–º–∞—É—Ç–∞</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏</span>
            <span class="n">element</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="n">selector</span><span class="p">))</span>
            <span class="p">)</span>
            
            <span class="c1"># –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –≤–∏–¥–∏–º</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">():</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;‚úÖ –≠–ª–µ–º–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω —Å–∫—Ä—ã—Ç–Ω–æ&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω, –Ω–æ –Ω–µ –≤–∏–¥–∏–º&quot;</span><span class="p">)</span>
                <span class="c1"># –ü–æ–ø—Ä–æ–±—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ —ç–ª–µ–º–µ–Ω—Ç—É</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].scrollIntoView({behavior: &#39;smooth&#39;, block: &#39;center&#39;});&quot;</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">():</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;‚úÖ –≠–ª–µ–º–µ–Ω—Ç —Å—Ç–∞–ª –≤–∏–¥–∏–º –ø–æ—Å–ª–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">scroll_error</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ —ç–ª–µ–º–µ–Ω—Ç—É: </span><span class="si">{</span><span class="n">scroll_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
                
        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –≠–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω: </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å–≤—è–∑–∞–Ω–∞ –ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–µ—Ç–µ–∫—Ü–∏–µ–π</span>
            <span class="k">if</span> <span class="n">check_stealth_detection</span><span class="p">(</span><span class="n">driver</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –¥–µ—Ç–µ–∫—Ü–∏—è, –ø—ã—Ç–∞–µ–º—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∞—Å–∫–∏—Ä–æ–≤–∫—É&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">restore_stealth_masking</span><span class="p">(</span><span class="n">driver</span><span class="p">):</span>
                    <span class="c1"># –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ–ø—ã—Ç–∫—É –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">element</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="n">selector</span><span class="p">))</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">():</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;‚úÖ –≠–ª–µ–º–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏&quot;</span><span class="p">)</span>
                            <span class="k">return</span> <span class="kc">True</span>
                    <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
                        <span class="k">pass</span>
            
            <span class="c1"># –ü–æ–ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã</span>
            <span class="n">alternative_selectors</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="c1"># –ï—Å–ª–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ—á–∫—É, –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã</span>
            <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
                <span class="c1"># –£–±–∏—Ä–∞–µ–º —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–±—É–µ–º –∫–∞–∫ –µ—Å—Ç—å</span>
                <span class="n">clean_selector</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clean_selector</span><span class="p">)</span>
                
                <span class="c1"># –ü—Ä–æ–±—É–µ–º —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º</span>
                <span class="n">escaped_selector</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.&#39;</span><span class="p">)</span>
                <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">escaped_selector</span><span class="p">)</span>
                
                <span class="c1"># –ü—Ä–æ–±—É–µ–º –∫–∞–∫ –∞—Ç—Ä–∏–±—É—Ç class (—É–±–∏—Ä–∞–µ–º —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞)</span>
                <span class="n">clean_for_class</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">class_parts</span> <span class="o">=</span> <span class="n">clean_for_class</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">class_name</span> <span class="o">=</span> <span class="n">class_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —á–∞—Å—Ç—å –∫–∞–∫ –∏–º—è –∫–ª–∞—Å—Å–∞</span>
                    <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[class*=&quot;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">)</span>
                    
                <span class="c1"># –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ —á–∞—Å—Ç–∏—á–Ω–æ–º—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é –∫–ª–∞—Å—Å–∞</span>
                <span class="k">if</span> <span class="s1">&#39;task&#39;</span> <span class="ow">in</span> <span class="n">clean_for_class</span><span class="p">:</span>
                    <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[class*=&quot;task&quot;]&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;claimNumber&#39;</span> <span class="ow">in</span> <span class="n">clean_for_class</span><span class="p">:</span>
                    <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[class*=&quot;claimNumber&quot;]&#39;</span><span class="p">)</span>
                    
                <span class="c1"># –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∫–ª–∞—Å—Å–æ–≤</span>
                <span class="k">if</span> <span class="s1">&#39;task&#39;</span> <span class="ow">in</span> <span class="n">clean_for_class</span> <span class="ow">and</span> <span class="s1">&#39;claimNumber&#39;</span> <span class="ow">in</span> <span class="n">clean_for_class</span><span class="p">:</span>
                    <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[class*=&quot;task&quot;][class*=&quot;claimNumber&quot;]&#39;</span><span class="p">)</span>
                    <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;.task.claimNumber&#39;</span><span class="p">)</span>
                    <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#root .task .claimNumber&#39;</span><span class="p">)</span>
                    <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#root.task.claimNumber&#39;</span><span class="p">)</span>
                    <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;input[class*=&quot;claimNumber&quot;]&#39;</span><span class="p">)</span>
                    <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;input[name*=&quot;claimNumber&quot;]&#39;</span><span class="p">)</span>
                    <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;input[id*=&quot;claimNumber&quot;]&#39;</span><span class="p">)</span>
                    <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[data-testid*=&quot;claimNumber&quot;]&#39;</span><span class="p">)</span>
            
            <span class="c1"># –ï—Å–ª–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç #, –ø—Ä–æ–±—É–µ–º –∫–∞–∫ id</span>
            <span class="k">if</span> <span class="s1">&#39;#&#39;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
                <span class="n">id_parts</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">id_name</span> <span class="o">=</span> <span class="n">id_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —á–∞—Å—Ç—å –∫–∞–∫ id</span>
                    <span class="c1"># –£–±–∏—Ä–∞–µ–º —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ id</span>
                    <span class="n">clean_id</span> <span class="o">=</span> <span class="n">id_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
                    <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[id=&quot;</span><span class="si">{</span><span class="n">clean_id</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">)</span>
                    <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[id*=&quot;</span><span class="si">{</span><span class="n">clean_id</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">)</span>
                    
                    <span class="c1"># –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ —á–∞—Å—Ç–∏—á–Ω–æ–º—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é id</span>
                    <span class="k">if</span> <span class="s1">&#39;root&#39;</span> <span class="ow">in</span> <span class="n">clean_id</span><span class="p">:</span>
                        <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[id*=&quot;root&quot;]&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;task&#39;</span> <span class="ow">in</span> <span class="n">clean_id</span><span class="p">:</span>
                        <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[id*=&quot;task&quot;]&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;claimNumber&#39;</span> <span class="ow">in</span> <span class="n">clean_id</span><span class="p">:</span>
                        <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[id*=&quot;claimNumber&quot;]&#39;</span><span class="p">)</span>
            
            <span class="c1"># –î–æ–±–∞–≤–ª—è–µ–º –æ–±—â–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã</span>
            <span class="n">clean_selector_for_attr</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">clean_selector_for_attr</span><span class="p">:</span>
                <span class="n">alternative_selectors</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
                    <span class="sa">f</span><span class="s1">&#39;*[data-testid*=&quot;</span><span class="si">{</span><span class="n">clean_selector_for_attr</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;*[aria-label*=&quot;</span><span class="si">{</span><span class="n">clean_selector_for_attr</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;*[name*=&quot;</span><span class="si">{</span><span class="n">clean_selector_for_attr</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;*[placeholder*=&quot;</span><span class="si">{</span><span class="n">clean_selector_for_attr</span><span class="si">}</span><span class="s1">&quot;]&#39;</span>
                <span class="p">])</span>
            
            <span class="c1"># –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Å–µ–ª–µ–∫—Ç–æ—Ä—ã</span>
            <span class="n">alternative_selectors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">alternative_selectors</span><span class="p">))</span>
            
            <span class="c1"># –õ–æ–≥–∏—Ä—É–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">alternative_selectors</span><span class="p">)</span><span class="si">}</span><span class="s2"> –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –¥–ª—è &#39;</span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">alt_sel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">alternative_selectors</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">alt_sel</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">alt_selector</span> <span class="ow">in</span> <span class="n">alternative_selectors</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä–∞</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">alt_selector</span> <span class="ow">or</span> <span class="n">alt_selector</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="k">continue</span>
                        
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîÑ –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: </span><span class="si">{</span><span class="n">alt_selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">element</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                        <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="n">alt_selector</span><span class="p">))</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">():</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ –≠–ª–µ–º–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω –ø–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–º—É —Å–µ–ª–µ–∫—Ç–æ—Ä—É: </span><span class="si">{</span><span class="n">alt_selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">selector_error</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä &#39;</span><span class="si">{</span><span class="n">alt_selector</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">selector_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
            
            <span class="k">return</span> <span class="kc">False</span>
            
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä—ã—Ç–Ω–æ–º –æ–∂–∏–¥–∞–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span> </div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; –ê–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞ 2024. </p>
  </div>

  –°–æ–±—Ä–∞–Ω–æ –ø—Ä–∏ –ø–æ–º–æ—â–∏ <a href="https://www.sphinx-doc.org/">Sphinx</a> —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">—Ç–µ–º—ã,</a>
    –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>