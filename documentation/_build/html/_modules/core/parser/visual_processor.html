

<!DOCTYPE html>
<html class="writer-html5" lang="ru" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>core.parser.visual_processor &mdash; –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Audotex Parser 1.0</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=8b205fae" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=9ca2116e"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/translations.js?v=cd1d70c9"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="–ê–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å" href="../../../genindex.html" />
    <link rel="search" title="–ü–æ–∏—Å–∫" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Audotex Parser
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏" aria-label="–ü–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="–ú–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏">
              <p class="caption" role="heading"><span class="caption-text">–ú–æ–¥—É–ª–∏:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/auth.html">–ú–æ–¥—É–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (auth)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/database.html">–ú–æ–¥—É–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (database)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/database.html#id3">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/database.html#er">ER-–¥–∏–∞–≥—Ä–∞–º–º–∞</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/parser.html">–ú–æ–¥—É–ª—å –ø–∞—Ä—Å–µ—Ä–∞ (parser)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/queue.html">–ú–æ–¥—É–ª—å –æ—á–µ—Ä–µ–¥–∏ (queue)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/security.html">–ú–æ–¥—É–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (security)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="–ú–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Audotex Parser</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">–ö–æ–¥ –º–æ–¥—É–ª—è</a></li>
      <li class="breadcrumb-item active">core.parser.visual_processor</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ core.parser.visual_processor</h1><div class="highlight"><pre>
<span></span><span class="c1"># –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å SVG, —Å–∫—Ä–∏–Ω—à–æ—Ç–∞–º–∏ –∏ –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º–∞–º–∏</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xml.etree.ElementTree</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ET</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lxml</span><span class="w"> </span><span class="kn">import</span> <span class="n">etree</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">transliterate</span><span class="w"> </span><span class="kn">import</span> <span class="n">translit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.by</span><span class="w"> </span><span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.support.ui</span><span class="w"> </span><span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.support</span><span class="w"> </span><span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.common.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">TimeoutException</span><span class="p">,</span> <span class="n">WebDriverException</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">TIMEOUT</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">selenium.webdriver.common.action_chains</span><span class="w"> </span><span class="kn">import</span> <span class="n">ActionChains</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –ø–æ —à–∞–±–ª–æ–Ω—É zone_*</span>
<div class="viewcode-block" id="is_zone_file">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.is_zone_file">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_zone_file</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ñ–∞–π–ª —Ñ–∞–π–ª–æ–º –∑–æ–Ω—ã.</span>
<span class="sd">    </span>
<span class="sd">    –§–∞–π–ª—ã –∑–æ–Ω –≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å &#39;zone_&#39; –∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç &#39;pictogram&#39; –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        filename: str - –∏–º—è —Ñ–∞–π–ª–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        bool - True –µ—Å–ª–∏ —Ñ–∞–π–ª —è–≤–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª–æ–º –∑–æ–Ω—ã</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filename_lower</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">is_zone</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename_lower</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;zone_&#39;</span><span class="p">)</span> <span class="ow">and</span> 
               <span class="s1">&#39;pictogram&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filename_lower</span> <span class="ow">and</span> 
               <span class="n">filename_lower</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.svg&#39;</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç is_zone_file(&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;): </span><span class="si">{</span><span class="n">is_zone</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">is_zone</span></div>



<span class="c1"># –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è SVG –Ω–∞ –¥–µ—Ç–∞–ª–∏</span>
<div class="viewcode-block" id="has_detail">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.has_detail">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">has_detail</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">detail</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-title&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">detail</span></div>



<div class="viewcode-block" id="prune_for_detail">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.prune_for_detail">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">prune_for_detail</span><span class="p">(</span><span class="n">root_element</span><span class="p">,</span> <span class="n">detail</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">root_element</span><span class="p">):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_detail</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">detail</span><span class="p">):</span>
            <span class="n">root_element</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prune_for_detail</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">detail</span><span class="p">)</span></div>


<span class="c1"># –§—É–Ω–∫—Ü–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å DOM</span>
<div class="viewcode-block" id="wait_for_document_ready">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.wait_for_document_ready">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">wait_for_document_ready</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;return document.readyState === &#39;complete&#39;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="wait_for_pictograms_grid">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.wait_for_pictograms_grid">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">wait_for_pictograms_grid</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="n">grids</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;main div.pictograms-grid.visible&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">grids</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ grid –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–∏–¥–∏–º –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–∫—Ü–∏–∏</span>
    <span class="k">return</span> <span class="n">grid</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;section&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="wait_for_all_sections_loaded">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.wait_for_all_sections_loaded">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">wait_for_all_sections_loaded</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="n">sections</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;main div.pictograms-grid.visible section.pictogram-section&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    
    <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ —Å–µ–∫—Ü–∏–∏ –≤–∏–¥–∏–º—ã –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç h2 –∑–∞–≥–æ–ª–æ–≤–∫–∏</span>
    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">section</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">h2_elements</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;h2.sort-title.visible&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">h2_elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="wait_for_all_svgs_ready">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.wait_for_all_svgs_ready">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">wait_for_all_svgs_ready</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="n">svg_containers</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> 
        <span class="s2">&quot;main div.pictograms-grid.visible section.pictogram-section div.navigation-pictogram-svg-container&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">svg_containers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
        
    <span class="n">ready_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">svg_containers</span><span class="p">:</span>
        <span class="n">svgs</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">svgs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">svg</span> <span class="o">=</span> <span class="n">svgs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">svg</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">()</span> <span class="ow">and</span> 
                <span class="n">d</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;return arguments[0].querySelectorAll(&#39;path, rect, circle, g&#39;).length &gt; 0&quot;</span><span class="p">,</span> <span class="n">svg</span><span class="p">)):</span>
                <span class="n">ready_count</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="c1"># –¢—Ä–µ–±—É–µ–º —á—Ç–æ–±—ã –º–∏–Ω–∏–º—É–º 80% SVG –±—ã–ª–∏ –≥–æ—Ç–æ–≤—ã (—É—á–∏—Ç—ã–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏)</span>
    <span class="n">required_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">svg_containers</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ready_count</span> <span class="o">&gt;=</span> <span class="n">required_count</span></div>


<div class="viewcode-block" id="wait_for_dom_stability">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.wait_for_dom_stability">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">wait_for_dom_stability</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="n">initial_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> 
        <span class="s2">&quot;main div.pictograms-grid.visible section.pictogram-section div.navigation-pictogram-svg-container svg&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">initial_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    
    <span class="c1"># –ñ–¥–µ–º 800ms –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">final_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> 
        <span class="s2">&quot;main div.pictograms-grid.visible section.pictogram-section div.navigation-pictogram-svg-container svg&quot;</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">initial_count</span> <span class="o">==</span> <span class="n">final_count</span> <span class="ow">and</span> <span class="n">initial_count</span> <span class="o">&gt;</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="ensure_document_ready">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.ensure_document_ready">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ensure_document_ready</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;return document.readyState === &#39;complete&#39;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="find_pictograms_grid_reliable">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.find_pictograms_grid_reliable">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">find_pictograms_grid_reliable</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="n">grids</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;main div.pictograms-grid.visible&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">grid</span> <span class="ow">in</span> <span class="n">grids</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">grid</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;section&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">grid</span>
    <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="wait_for_sections_stability">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.wait_for_sections_stability">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">wait_for_sections_stability</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="n">sections</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;main div.pictograms-grid.visible section.pictogram-section&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    
    <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫–∞–∂–¥–∞—è —Å–µ–∫—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã</span>
    <span class="n">ready_sections</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
        <span class="n">h2_elements</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;h2.sort-title.visible&quot;</span><span class="p">)</span>
        <span class="n">holders</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;pictograms-grid-holder&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">h2_elements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">holders</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">section</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">():</span>
            <span class="n">ready_sections</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="k">return</span> <span class="n">ready_sections</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="wait_for_works_in_section">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.wait_for_works_in_section">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">wait_for_works_in_section</span><span class="p">(</span><span class="n">holder</span><span class="p">):</span>
    <span class="n">work_divs</span> <span class="o">=</span> <span class="p">[</span><span class="n">div</span> <span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">holder</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">)</span> 
                <span class="k">if</span> <span class="n">div</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;data-tooltip&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">div</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">()]</span>
    <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —É –∫–∞–∂–¥–æ–π —Ä–∞–±–æ—Ç—ã –µ—Å—Ç—å SVG –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä</span>
    <span class="n">ready_works</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">work_divs</span><span class="p">:</span>
        <span class="n">containers</span> <span class="o">=</span> <span class="n">div</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div.navigation-pictogram-svg-container&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">containers</span> <span class="ow">and</span> <span class="n">containers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">():</span>
            <span class="n">svgs</span> <span class="o">=</span> <span class="n">containers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">svgs</span> <span class="ow">and</span> <span class="n">svgs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">():</span>
                <span class="n">ready_works</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">work_divs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ready_works</span> <span class="o">&gt;=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">work_divs</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">))</span></div>


<span class="c1"># –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è SVG –Ω–∞ –¥–µ—Ç–∞–ª–∏</span>
<div class="viewcode-block" id="split_svg_by_details">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.split_svg_by_details">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">split_svg_by_details</span><span class="p">(</span><span class="n">svg_file</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">subfolder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">claim_number</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">vin</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">svg_collection</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –†–∞–∑–±–∏–≤–∞–µ—Ç SVG-—Ñ–∞–π–ª –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ SVG –¥–ª—è –∫–∞–∂–¥–æ–π –¥–µ—Ç–∞–ª–∏, –≥–¥–µ –∫–∞–∂–¥–∞—è –¥–µ—Ç–∞–ª—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É data-title.</span>
<span class="sd">    –ï—Å–ª–∏ svg_collection=False, –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤.</span>
<span class="sd">    –ì–ê–†–ê–ù–¢–ò–†–£–ï–¢ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –∏–∑ –ª—é–±–æ–≥–æ SVG —Ñ–∞–π–ª–∞ –∑–æ–Ω—ã.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># –û—á–∏—â–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –æ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –∏ —Å–∏–º–≤–æ–ª–æ–≤ —Ç–∞–±—É–ª—è—Ü–∏–∏</span>
    <span class="n">clean_claim_number</span> <span class="o">=</span> <span class="n">claim_number</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">claim_number</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">clean_vin</span> <span class="o">=</span> <span class="n">vin</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">vin</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîß –ù–ê–ß–ò–ù–ê–ï–ú —Ä–∞–∑–±–∏–µ–Ω–∏–µ SVG —Ñ–∞–π–ª–∞: </span><span class="si">{</span><span class="n">svg_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üéõÔ∏è –†–µ–∂–∏–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è SVG: </span><span class="si">{</span><span class="s1">&#39;–í–ö–õ–Æ–ß–ï–ù&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">svg_collection</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;–û–¢–ö–õ–Æ–ß–ï–ù&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: claim_number=&#39;</span><span class="si">{</span><span class="n">claim_number</span><span class="si">}</span><span class="s2">&#39;, vin=&#39;</span><span class="si">{</span><span class="n">vin</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç –û—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: clean_claim_number=&#39;</span><span class="si">{</span><span class="n">clean_claim_number</span><span class="si">}</span><span class="s2">&#39;, clean_vin=&#39;</span><span class="si">{</span><span class="n">clean_vin</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">svg_file</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: </span><span class="si">{</span><span class="n">svg_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
        
        <span class="c1"># –ß–∏—Ç–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</span>
        <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">svg_file</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìä –†–∞–∑–º–µ—Ä SVG —Ñ–∞–π–ª–∞: </span><span class="si">{</span><span class="n">file_size</span><span class="si">}</span><span class="s2"> –±–∞–π—Ç&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">file_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –§–∞–π–ª –ø—É—Å—Ç–æ–π: </span><span class="si">{</span><span class="n">svg_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
        
        <span class="c1"># –ü—ã—Ç–∞–µ–º—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">svg_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">content_preview</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>  <span class="c1"># –ü–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìÑ –ü—Ä–µ–≤—å—é —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞: </span><span class="si">{</span><span class="n">content_preview</span><span class="p">[:</span><span class="mi">200</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">read_error</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: </span><span class="si">{</span><span class="n">read_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
        
        <span class="c1"># –ü–∞—Ä—Å–∏–º XML</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">svg_file</span><span class="p">)</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ SVG —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω. –ö–æ—Ä–Ω–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç: </span><span class="si">{</span><span class="n">root</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ET</span><span class="o">.</span><span class="n">ParseError</span> <span class="k">as</span> <span class="n">parse_error</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ XML: </span><span class="si">{</span><span class="n">parse_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
        
        <span class="c1"># –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å data-title</span>
        <span class="n">elements_with_data_title</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_elements</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">iter</span><span class="p">():</span>
            <span class="n">total_elements</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="s1">&#39;data-title&#39;</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                <span class="n">elements_with_data_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìä –í—Å–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ SVG: </span><span class="si">{</span><span class="n">total_elements</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üéØ –≠–ª–µ–º–µ–Ω—Ç–æ–≤ —Å data-title: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">elements_with_data_title</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements_with_data_title</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è –ù–ï –ù–ê–ô–î–ï–ù–û —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å data-title –≤ —Ñ–∞–π–ª–µ </span><span class="si">{</span><span class="n">svg_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã...&quot;</span><span class="p">)</span>
            
            <span class="c1"># –ü–æ–∏—Å–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</span>
            <span class="n">alt_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">alt_attributes</span><span class="p">:</span>
                <span class="n">elements_with_attr</span> <span class="o">=</span> <span class="p">[</span><span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">iter</span><span class="p">()</span> <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">elements_with_attr</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç –ù–∞–π–¥–µ–Ω–æ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">elements_with_attr</span><span class="p">)</span><span class="si">}</span><span class="s2"> —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º &#39;</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements_with_attr</span><span class="p">[:</span><span class="mi">5</span><span class="p">]):</span>  <span class="c1"># –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 5</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">elem</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">=&#39;</span><span class="si">{</span><span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            
            <span class="c1"># –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫, –Ω–æ –Ω–µ –æ—à–∏–±–∫—É</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –¥–µ—Ç–∞–ª–µ–π –¥–ª—è </span><span class="si">{</span><span class="n">svg_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
        
        <span class="c1"># –°–æ–±–∏—Ä–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ data-title</span>
        <span class="n">all_titles</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;data-title&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elements_with_data_title</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">üéØ –ù–∞–π–¥–µ–Ω–æ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_titles</span><span class="p">)</span><span class="si">}</span><span class="s2"> —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö data-title –≤ —Ñ–∞–π–ª–µ </span><span class="si">{</span><span class="n">svg_file</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="n">detail_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">all_titles</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  üìù &#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">detail</span> <span class="ow">in</span> <span class="n">all_titles</span><span class="p">:</span>
            <span class="c1"># –û—á–∏—â–∞–µ–º –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª–Ω–æ–≥–æ data-title</span>
            <span class="n">safe_detail</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\w\s-]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">detail</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># –£–¥–∞–ª—è–µ–º –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">safe_detail</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ü—Ä–æ–ø—É—â–µ–Ω–æ –ø—É—Å—Ç–æ–µ –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ data-title: </span><span class="si">{</span><span class="n">detail</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">safe_name</span> <span class="o">=</span> <span class="n">translit</span><span class="p">(</span><span class="n">safe_detail</span><span class="p">,</span> <span class="s1">&#39;ru&#39;</span><span class="p">,</span> <span class="nb">reversed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">safe_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\.+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">safe_name</span><span class="p">)</span>  <span class="c1"># –£–¥–∞–ª—è–µ–º —Ç–æ—á–∫–∏</span>

            <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –¥–µ—Ç–∞–ª—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (—Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—è—Ç—ã–º–∏)</span>
            <span class="c1"># –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –û–°</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">platform</span>
            <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
                <span class="n">max_filename_length</span> <span class="o">=</span> <span class="mi">180</span>  <span class="c1"># –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –¥–ª–∏–Ω–∞ –¥–ª—è Windows</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_filename_length</span> <span class="o">=</span> <span class="mi">255</span>  <span class="c1"># –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –¥–ª–∏–Ω–∞ –¥–ª—è Linux/Unix —Å–∏—Å—Ç–µ–º</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">safe_name</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_filename_length</span><span class="p">:</span>
                <span class="c1"># –û–±—ã—á–Ω—ã–π —Å–ª—É—á–∞–π - –∏–º—è –Ω–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ</span>
                <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">safe_name</span><span class="si">}</span><span class="s2">.svg&quot;</span><span class="p">))</span>
                <span class="n">relative_base</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/static/svgs/</span><span class="si">{</span><span class="n">clean_claim_number</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">clean_vin</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">output_path_relative</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relative_base</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">safe_name</span><span class="si">}</span><span class="s2">.svg&quot;</span><span class="p">)</span>

                <span class="n">detail_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">detail</span><span class="p">,</span>
                    <span class="s2">&quot;svg_path&quot;</span><span class="p">:</span> <span class="n">output_path_relative</span> <span class="k">if</span> <span class="n">svg_collection</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="p">}</span>
                <span class="n">detail_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">detail_data</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìù –î–µ—Ç–∞–ª—å –∏–∑–≤–ª–µ—á–µ–Ω–∞: &#39;</span><span class="si">{</span><span class="n">detail</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">detail</span><span class="p">)</span><span class="si">}</span><span class="s2"> —Å–∏–º–≤–æ–ª–æ–≤)&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">svg_collection</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">svg_file</span><span class="p">)</span>
                        <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
                        <span class="n">prune_for_detail</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">detail</span><span class="p">)</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">tree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">xml_declaration</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">save_error</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è SVG –¥–ª—è –¥–µ—Ç–∞–ª–∏ &#39;</span><span class="si">{</span><span class="n">detail</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">save_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">detail_data</span><span class="p">[</span><span class="s2">&quot;svg_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># –î–ª–∏–Ω–Ω–æ–µ –∏–º—è - —Ä–∞–∑–±–∏–≤–∞–µ–º –ø–æ –∑–∞–ø—è—Ç—ã–º –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≥—Ä—É–ø–ø—ã</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üî™ –ò–º—è –¥–µ—Ç–∞–ª–∏ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">safe_name</span><span class="p">)</span><span class="si">}</span><span class="s2"> —Å–∏–º–≤–æ–ª–æ–≤), —Ä–∞–∑–±–∏–≤–∞–µ–º –ø–æ –¥–µ—Ç–∞–ª—è–º: </span><span class="si">{</span><span class="n">detail</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1"># –†–∞–∑–¥–µ–ª—è–µ–º –ø–æ –∑–∞–ø—è—Ç—ã–º</span>
                <span class="n">individual_details</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">detail</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç –ù–∞–π–¥–µ–Ω–æ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">individual_details</span><span class="p">)</span><span class="si">}</span><span class="s2"> –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –¥–µ—Ç–∞–ª–µ–π –≤ –≥—Ä—É–ø–ø–µ&quot;</span><span class="p">)</span>
                
                <span class="c1"># –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–µ—Ç–∞–ª–∏ —Ç–∞–∫, —á—Ç–æ–±—ã –∏–º—è —Ñ–∞–π–ª–∞ –Ω–µ –ø—Ä–µ–≤—ã—à–∞–ª–æ –ª–∏–º–∏—Ç</span>
                <span class="n">current_group</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">current_group_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">part_num</span> <span class="o">=</span> <span class="mi">1</span>
                
                <span class="k">for</span> <span class="n">detail_item</span> <span class="ow">in</span> <span class="n">individual_details</span><span class="p">:</span>
                    <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–º–µ—Å—Ç–∏—Ç—Å—è –ª–∏ —ç—Ç–∞ –¥–µ—Ç–∞–ª—å –≤ —Ç–µ–∫—É—â—É—é –≥—Ä—É–ø–ø—É</span>
                    <span class="n">test_group_text</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_group</span> <span class="o">+</span> <span class="p">[</span><span class="n">detail_item</span><span class="p">])</span>
                    <span class="n">test_safe_name</span> <span class="o">=</span> <span class="n">translit</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\w\s,-]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">test_group_text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;ru&#39;</span><span class="p">,</span> <span class="nb">reversed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="n">test_safe_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\.+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">test_safe_name</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_safe_name</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_filename_length</span><span class="p">:</span>
                        <span class="c1"># –ü–æ–º–µ—â–∞–µ—Ç—Å—è - –¥–æ–±–∞–≤–ª—è–µ–º –≤ —Ç–µ–∫—É—â—É—é –≥—Ä—É–ø–ø—É</span>
                        <span class="n">current_group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">detail_item</span><span class="p">)</span>
                        <span class="n">current_group_text</span> <span class="o">=</span> <span class="n">test_group_text</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># –ù–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è - —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –≥—Ä—É–ø–ø—É –∏ –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é</span>
                        <span class="k">if</span> <span class="n">current_group</span><span class="p">:</span>
                            <span class="n">group_title</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_group</span><span class="p">)</span>
                            <span class="n">group_safe_name</span> <span class="o">=</span> <span class="n">translit</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\w\s,-]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">group_title</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;ru&#39;</span><span class="p">,</span> <span class="nb">reversed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                            <span class="n">group_safe_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\.+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">group_safe_name</span><span class="p">)</span>
                            
                            <span class="n">group_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">group_safe_name</span><span class="si">}</span><span class="s2">_group</span><span class="si">{</span><span class="n">part_num</span><span class="si">}</span><span class="s2">.svg&quot;</span>
                            <span class="n">group_output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">group_filename</span><span class="p">))</span>
                            <span class="n">relative_base</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/static/svgs/</span><span class="si">{</span><span class="n">clean_claim_number</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">clean_vin</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="n">group_output_path_relative</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relative_base</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">group_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            
                            <span class="n">detail_data</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">group_title</span><span class="p">,</span>
                                <span class="s2">&quot;svg_path&quot;</span><span class="p">:</span> <span class="n">group_output_path_relative</span> <span class="k">if</span> <span class="n">svg_collection</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                            <span class="p">}</span>
                            <span class="n">detail_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">detail_data</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìù –ì—Ä—É–ø–ø–∞ </span><span class="si">{</span><span class="n">part_num</span><span class="si">}</span><span class="s2"> –∏–∑–≤–ª–µ—á–µ–Ω–∞: &#39;</span><span class="si">{</span><span class="n">group_title</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}{</span><span class="s1">&#39;...&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">group_title</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&#39; -&gt; </span><span class="si">{</span><span class="n">group_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">svg_collection</span><span class="p">:</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">svg_file</span><span class="p">)</span>
                                    <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
                                    <span class="n">prune_for_detail</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">detail</span><span class="p">)</span>  <span class="c1"># –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</span>
                                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">group_output_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                    <span class="n">tree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">group_output_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">xml_declaration</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ –ì—Ä—É–ø–ø–∞ </span><span class="si">{</span><span class="n">part_num</span><span class="si">}</span><span class="s2"> —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: </span><span class="si">{</span><span class="n">group_output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">save_error</span><span class="p">:</span>
                                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è SVG –¥–ª—è –≥—Ä—É–ø–ø—ã </span><span class="si">{</span><span class="n">part_num</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">save_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                    <span class="n">detail_data</span><span class="p">[</span><span class="s2">&quot;svg_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                            
                            <span class="n">part_num</span> <span class="o">+=</span> <span class="mi">1</span>
                        
                        <span class="c1"># –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É —Å —Ç–µ–∫—É—â–µ–π –¥–µ—Ç–∞–ª—å—é</span>
                        <span class="n">current_group</span> <span class="o">=</span> <span class="p">[</span><span class="n">detail_item</span><span class="p">]</span>
                        <span class="n">current_group_text</span> <span class="o">=</span> <span class="n">detail_item</span>
                
                <span class="c1"># –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≥—Ä—É–ø–ø—É</span>
                <span class="k">if</span> <span class="n">current_group</span><span class="p">:</span>
                    <span class="n">group_title</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_group</span><span class="p">)</span>
                    <span class="n">group_safe_name</span> <span class="o">=</span> <span class="n">translit</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\w\s,-]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">group_title</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;ru&#39;</span><span class="p">,</span> <span class="nb">reversed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                    <span class="n">group_safe_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\.+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">group_safe_name</span><span class="p">)</span>
                    
                    <span class="n">group_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">group_safe_name</span><span class="si">}</span><span class="s2">_group</span><span class="si">{</span><span class="n">part_num</span><span class="si">}</span><span class="s2">.svg&quot;</span>
                    <span class="n">group_output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">group_filename</span><span class="p">))</span>
                    <span class="n">relative_base</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/static/svgs/</span><span class="si">{</span><span class="n">clean_claim_number</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">clean_vin</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">group_output_path_relative</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relative_base</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">group_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="n">detail_data</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">group_title</span><span class="p">,</span>
                        <span class="s2">&quot;svg_path&quot;</span><span class="p">:</span> <span class="n">group_output_path_relative</span> <span class="k">if</span> <span class="n">svg_collection</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="p">}</span>
                    <span class="n">detail_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">detail_data</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìù –§–∏–Ω–∞–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞ </span><span class="si">{</span><span class="n">part_num</span><span class="si">}</span><span class="s2"> –∏–∑–≤–ª–µ—á–µ–Ω–∞: &#39;</span><span class="si">{</span><span class="n">group_title</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}{</span><span class="s1">&#39;...&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">group_title</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&#39; -&gt; </span><span class="si">{</span><span class="n">group_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">svg_collection</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">svg_file</span><span class="p">)</span>
                            <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
                            <span class="n">prune_for_detail</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">detail</span><span class="p">)</span>  <span class="c1"># –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">group_output_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="n">tree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">group_output_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">xml_declaration</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞ </span><span class="si">{</span><span class="n">part_num</span><span class="si">}</span><span class="s2"> —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: </span><span class="si">{</span><span class="n">group_output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">save_error</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è SVG –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –≥—Ä—É–ø–ø—ã </span><span class="si">{</span><span class="n">part_num</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">save_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">detail_data</span><span class="p">[</span><span class="s2">&quot;svg_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üéØ –í—Å–µ–≥–æ —Å–æ–∑–¥–∞–Ω–æ </span><span class="si">{</span><span class="n">part_num</span><span class="si">}</span><span class="s2"> –≥—Ä—É–ø–ø –∏–∑ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">individual_details</span><span class="p">)</span><span class="si">}</span><span class="s2"> –¥–µ—Ç–∞–ª–µ–π&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ –§—É–Ω–∫—Ü–∏—è split_svg_by_details –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û –¥–ª—è —Ñ–∞–π–ª–∞ </span><span class="si">{</span><span class="n">svg_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üéØ –ò–¢–û–ì–û –∏–∑–≤–ª–µ—á–µ–Ω–æ –¥–µ—Ç–∞–ª–µ–π: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">detail_paths</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">detail_paths</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìù –°–ø–∏—Å–æ–∫ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –¥–µ—Ç–∞–ª–µ–π:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">detail</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">detail_paths</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">svg_status</span> <span class="o">=</span> <span class="s2">&quot;—Å —Ñ–∞–π–ª–æ–º&quot;</span> <span class="k">if</span> <span class="n">detail</span><span class="p">[</span><span class="s2">&quot;svg_path&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;—Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. &#39;</span><span class="si">{</span><span class="n">detail</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; (</span><span class="si">{</span><span class="n">svg_status</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è –ù–ï –ù–ê–ô–î–ï–ù–û –¥–µ—Ç–∞–ª–µ–π –≤ —Ñ–∞–π–ª–µ </span><span class="si">{</span><span class="n">svg_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">detail_paths</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –≤ split_svg_by_details –¥–ª—è —Ñ–∞–π–ª–∞ </span><span class="si">{</span><span class="n">svg_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –¢–∏–ø –æ—à–∏–±–∫–∏: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –ü–æ–ª–Ω—ã–π traceback: </span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span></div>


<span class="c1"># –°–æ—Ö—Ä–∞–Ω—è–µ—Ç SVG —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ü–≤–µ—Ç–æ–≤</span>
<div class="viewcode-block" id="save_svg_sync">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.save_svg_sync">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">save_svg_sync</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">claim_number</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vin</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">svg_collection</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">tag_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–≠–ª–µ–º–µ–Ω—Ç </span><span class="si">{</span><span class="n">element</span><span class="o">.</span><span class="n">tag_name</span><span class="si">}</span><span class="s2"> –Ω–µ —è–≤–ª—è–µ—Ç—Å—è SVG –∏–ª–∏ –≥—Ä—É–ø–ø–æ–π&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[]</span>

        <span class="c1"># –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤</span>
        <span class="n">has_children</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            return arguments[0].children.length &gt; 0;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_children</span> <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">tag_name</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;–ì—Ä—É–ø–ø–∞ </span><span class="si">{</span><span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;data-title&#39;</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;–±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è&#39;</span><span class="si">}</span><span class="s2"> –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[]</span>

        <span class="c1"># –ò–∑–≤–ª–µ–∫–∞–µ–º –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            let element = arguments[0];</span>
<span class="s2">            function setInlineStyles(el) {</span>
<span class="s2">                try {</span>
<span class="s2">                let computed = window.getComputedStyle(el);</span>
<span class="s2">                if (computed.fill &amp;&amp; computed.fill !== &#39;none&#39;) {</span>
<span class="s2">                    el.setAttribute(&#39;fill&#39;, computed.fill);</span>
<span class="s2">                }</span>
<span class="s2">                if (computed.stroke &amp;&amp; computed.stroke !== &#39;none&#39;) {</span>
<span class="s2">                    el.setAttribute(&#39;stroke&#39;, computed.stroke);</span>
<span class="s2">                }</span>
<span class="s2">                if (computed.strokeWidth &amp;&amp; computed.strokeWidth !== &#39;0px&#39;) {</span>
<span class="s2">                    el.setAttribute(&#39;stroke-width&#39;, computed.strokeWidth);</span>
<span class="s2">                }</span>
<span class="s2">                for (let child of el.children) {</span>
<span class="s2">                    setInlineStyles(child);</span>
<span class="s2">                    }</span>
<span class="s2">                } catch (e) {</span>
<span class="s2">                    console.warn(&#39;–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ç–∏–ª–∏ –∫ —ç–ª–µ–º–µ–Ω—Ç—É:&#39;, e);</span>
<span class="s2">                }</span>
<span class="s2">            }</span>
<span class="s2">            setInlineStyles(element);</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>

        <span class="n">svg_content</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;outerHTML&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">tag_name</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
            <span class="c1"># –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ SVG</span>
            <span class="n">parent_svg</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                let el = arguments[0];</span>
<span class="s2">                while (el &amp;&amp; el.tagName.toLowerCase() !== &#39;svg&#39;) {</span>
<span class="s2">                    el = el.parentElement;</span>
<span class="s2">                    // –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞</span>
<span class="s2">                    if (!el || el === document.documentElement) {</span>
<span class="s2">                        return null;</span>
<span class="s2">                    }</span>
<span class="s2">                }</span>
<span class="s2">                return el;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">parent_svg</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π SVG –¥–ª—è –≥—Ä—É–ø–ø—ã&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[]</span>

            <span class="c1"># –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –æ—à–∏–±–æ–∫</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                let element = arguments[0];</span>
<span class="s2">                let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;</span>
<span class="s2">                function computeBounds(el) {</span>
<span class="s2">                    try {</span>
<span class="s2">                    if (el.tagName === &#39;path&#39; || el.tagName === &#39;rect&#39; || el.tagName === &#39;circle&#39;) {</span>
<span class="s2">                        let bbox = el.getBBox();</span>
<span class="s2">                        if (bbox.width &gt; 0 &amp;&amp; bbox.height &gt; 0) {</span>
<span class="s2">                            minX = Math.min(minX, bbox.x);</span>
<span class="s2">                            minY = Math.min(minY, bbox.y);</span>
<span class="s2">                            maxX = Math.max(maxX, bbox.x + bbox.width);</span>
<span class="s2">                            maxY = Math.max(maxY, bbox.y + bbox.height);</span>
<span class="s2">                        }</span>
<span class="s2">                    }</span>
<span class="s2">                    for (let child of el.children) {</span>
<span class="s2">                        computeBounds(child);</span>
<span class="s2">                        }</span>
<span class="s2">                    } catch (e) {</span>
<span class="s2">                        console.warn(&#39;–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ –≥—Ä–∞–Ω–∏—Ü —ç–ª–µ–º–µ–Ω—Ç–∞:&#39;, e);</span>
<span class="s2">                    }</span>
<span class="s2">                }</span>
<span class="s2">                computeBounds(element);</span>
<span class="s2">                return [minX, minY, maxX - minX, maxY - minY];</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;–ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è viewBox, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞–ø–∞—Å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ&quot;</span><span class="p">)</span>
                <span class="n">view_box</span> <span class="o">=</span> <span class="s1">&#39;0 0 1000 1000&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">padding</span> <span class="o">=</span> <span class="mi">10</span>
                <span class="n">view_box</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">padding</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">padding</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">padding</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">padding</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">width</span> <span class="o">=</span> <span class="s1">&#39;100%&#39;</span>
            <span class="n">height</span> <span class="o">=</span> <span class="s1">&#39;100%&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">view_box</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;viewBox&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;0 0 1000 1000&#39;</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;100%&#39;</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;100%&#39;</span>

        <span class="c1"># –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π</span>
        <span class="n">style_content</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            let styles = &#39;&#39;;</span>
<span class="s2">            try {</span>
<span class="s2">            const styleSheets = document.styleSheets;</span>
<span class="s2">            for (let sheet of styleSheets) {</span>
<span class="s2">                try {</span>
<span class="s2">                    for (let rule of sheet.cssRules) {</span>
<span class="s2">                        if (rule.selectorText &amp;&amp; (</span>
<span class="s2">                            rule.selectorText.includes(&#39;svg&#39;) || </span>
<span class="s2">                            rule.selectorText.includes(&#39;path&#39;) || </span>
<span class="s2">                            rule.selectorText.includes(&#39;rect&#39;) || </span>
<span class="s2">                            rule.selectorText.includes(&#39;circle&#39;) || </span>
<span class="s2">                            rule.selectorText.includes(&#39;g&#39;) ||</span>
<span class="s2">                            rule.selectorText.includes(&#39;[fill]&#39;) ||</span>
<span class="s2">                            rule.selectorText.includes(&#39;[stroke]&#39;)</span>
<span class="s2">                        )) {</span>
<span class="s2">                            styles += rule.cssText + &#39;</span><span class="se">\\</span><span class="s2">n&#39;;</span>
<span class="s2">                        }</span>
<span class="s2">                    }</span>
<span class="s2">                } catch (e) {</span>
<span class="s2">                        console.warn(&#39;–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å—Ç–∏–ª—è–º –ª–∏—Å—Ç–∞:&#39;, e);</span>
<span class="s2">                }</span>
<span class="s2">                }</span>
<span class="s2">            } catch (e) {</span>
<span class="s2">                console.warn(&#39;–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å—Ç–∏–ª—è–º –¥–æ–∫—É–º–µ–Ω—Ç–∞:&#39;, e);</span>
<span class="s2">            }</span>
<span class="s2">            return styles;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="n">svg_full_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="s2">&lt;svg width=&quot;</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">&quot; height=&quot;</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">&quot; viewBox=&quot;</span><span class="si">{</span><span class="n">view_box</span><span class="si">}</span><span class="s2">&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;&gt;</span>
<span class="s2">&lt;style&gt;</span>
<span class="si">{</span><span class="n">style_content</span><span class="si">}</span>
<span class="s2">svg * </span><span class="se">{{</span>
<span class="s2">    fill: inherit;</span>
<span class="s2">    stroke: inherit;</span>
<span class="s2">    stroke-width: inherit;</span>
<span class="se">}}</span>
<span class="s2">&lt;/style&gt;</span>
<span class="si">{</span><span class="n">svg_content</span><span class="si">}</span>
<span class="s2">&lt;/svg&gt;&quot;&quot;&quot;</span>

        <span class="n">svg_bytes</span> <span class="o">=</span> <span class="n">svg_full_content</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">XMLParser</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">svg_bytes</span><span class="p">,</span> <span class="n">parser</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ SVG: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[]</span>

        <span class="c1"># –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω—É–∂–Ω–æ –ª–∏ —Ä–∞–∑–±–∏–≤–∞—Ç—å –Ω–∞ –¥–µ—Ç–∞–ª–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∑–æ–Ω, –Ω–µ –¥–ª—è –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º)</span>
        <span class="n">should_split_details</span> <span class="o">=</span> <span class="s1">&#39;pictograms&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">path</span>
        <span class="n">detail_paths</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç –ê–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–∞: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç should_split_details: </span><span class="si">{</span><span class="n">should_split_details</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">should_split_details</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">is_zone</span> <span class="o">=</span> <span class="n">is_zone_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç –ò–º—è —Ñ–∞–π–ª–∞: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç is_zone_file: </span><span class="si">{</span><span class="n">is_zone</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">is_zone</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üéØ –ó–û–ù–ê –û–ë–ù–ê–†–£–ñ–ï–ù–ê: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> - –ì–ê–†–ê–ù–¢–ò–†–£–ï–ú –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–µ—Ç–∞–ª–µ–π!&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">svg_collection</span><span class="p">:</span>
                        <span class="c1"># –†–µ–∂–∏–º –ø–æ–ª–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π SVG + —Ä–∞–∑–±–∏–≤–∞–µ–º + —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–µ—Ç–∞–ª–∏</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">svg_bytes</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ SVG –∑–æ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—ë–Ω: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîß –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∞–∑–±–∏–µ–Ω–∏–µ –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–µ—Ç–∞–ª–µ–π&quot;</span><span class="p">)</span>
                        <span class="n">detail_paths</span> <span class="o">=</span> <span class="n">split_svg_by_details</span><span class="p">(</span>
                            <span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span>
                            <span class="n">claim_number</span><span class="o">=</span><span class="n">claim_number</span><span class="p">,</span> <span class="n">vin</span><span class="o">=</span><span class="n">vin</span><span class="p">,</span> <span class="n">svg_collection</span><span class="o">=</span><span class="n">svg_collection</span>
                        <span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üéØ –†–∞–∑–±–∏–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: –ø–æ–ª—É—á–µ–Ω–æ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">detail_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> –¥–µ—Ç–∞–ª–µ–π&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># –†–µ–∂–∏–º —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã—Ö: –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π SVG, –Ω–æ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏–∑–≤–ª–µ–∫–∞–µ–º –¥–µ—Ç–∞–ª–∏</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üéõÔ∏è –°–±–æ—Ä SVG –æ—Ç–∫–ª—é—á–µ–Ω, –Ω–æ –ì–ê–†–ê–ù–¢–ò–†–£–ï–ú –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –¥–µ—Ç–∞–ª—è—Ö –∑–æ–Ω—ã: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                        <span class="c1"># –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –¥–µ—Ç–∞–ª—è—Ö</span>
                        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wb&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.svg&#39;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">temp_file</span><span class="p">:</span>
                            <span class="n">temp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">svg_bytes</span><span class="p">)</span>
                            <span class="n">temp_path</span> <span class="o">=</span> <span class="n">temp_file</span><span class="o">.</span><span class="n">name</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîß –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∞–∑–±–∏–µ–Ω–∏–µ –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> –ë–ï–ó —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ)&quot;</span><span class="p">)</span>
                            <span class="n">detail_paths</span> <span class="o">=</span> <span class="n">split_svg_by_details</span><span class="p">(</span>
                                <span class="n">temp_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span>
                                <span class="n">claim_number</span><span class="o">=</span><span class="n">claim_number</span><span class="p">,</span> <span class="n">vin</span><span class="o">=</span><span class="n">vin</span><span class="p">,</span> <span class="n">svg_collection</span><span class="o">=</span><span class="n">svg_collection</span>
                            <span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üéØ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–æ: –ø–æ–ª—É—á–µ–Ω–æ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">detail_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> –¥–µ—Ç–∞–ª–µ–π&quot;</span><span class="p">)</span>

                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">detail_paths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å –¥–µ—Ç–∞–ª–∏ –∏–∑ –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞: </span><span class="si">{</span><span class="n">temp_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="c1"># –ù–ï —É–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞: </span><span class="si">{</span><span class="n">temp_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ</span>
                                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">temp_path</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">detail_error</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–µ—Ç–∞–ª–µ–π –∏–∑ –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">detail_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="c1"># –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞: </span><span class="si">{</span><span class="n">temp_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># –ù–µ zone —Ñ–∞–π–ª - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ –æ–±—ã—á–Ω–æ</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìÑ –§–∞–π–ª </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∑–æ–Ω–æ–π&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">svg_collection</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">svg_bytes</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ SVG —Å–æ—Ö—Ä–∞–Ω—ë–Ω: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üéõÔ∏è –°–±–æ—Ä SVG –æ—Ç–∫–ª—é—á–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">detail_paths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># –ü–∏–∫—Ç–æ–≥—Ä–∞–º–º–∞ - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ —Ä–∞–Ω—å—à–µ</span>
                <span class="k">if</span> <span class="n">svg_collection</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">svg_bytes</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ SVG –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º—ã —Å–æ—Ö—Ä–∞–Ω—ë–Ω: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üéõÔ∏è –°–±–æ—Ä SVG –æ—Ç–∫–ª—é—á–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º—ã: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">detail_paths</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">detail_paths</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ SVG: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ SVG: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[]</span></div>


<span class="c1"># –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–Ω—à–æ—Ç –∏ SVG</span>
<div class="viewcode-block" id="save_main_screenshot_and_svg">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.save_main_screenshot_and_svg">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">save_main_screenshot_and_svg</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">screenshot_dir</span><span class="p">,</span> <span class="n">svg_dir</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">claim_number</span><span class="p">,</span> <span class="n">vin</span><span class="p">,</span> <span class="n">svg_collection</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># –û—á–∏—â–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –æ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –∏ —Å–∏–º–≤–æ–ª–æ–≤ —Ç–∞–±—É–ª—è—Ü–∏–∏</span>
    <span class="n">clean_claim_number</span> <span class="o">=</span> <span class="n">claim_number</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">claim_number</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">clean_vin</span> <span class="o">=</span> <span class="n">vin</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">vin</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    
    <span class="n">main_screenshot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">screenshot_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;main_screenshot.png&quot;</span><span class="p">)</span>
    <span class="n">main_screenshot_relative</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/static/screenshots/</span><span class="si">{</span><span class="n">clean_claim_number</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">clean_vin</span><span class="si">}</span><span class="s2">/main_screenshot.png&quot;</span>
    <span class="n">main_svg_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">svg_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;main.svg&quot;</span><span class="p">)</span>
    <span class="n">main_svg_relative</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/static/svgs/</span><span class="si">{</span><span class="n">clean_claim_number</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">clean_vin</span><span class="si">}</span><span class="s2">/main.svg&quot;</span>

    <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ SVG –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">svg</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">)</span>
        
        <span class="c1"># –£–ë–ò–†–ê–ï–ú HOVER –≠–§–§–ï–ö–¢–´ –ø–µ—Ä–µ–¥ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–º</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;üñ±Ô∏è –£–±–∏—Ä–∞–µ–º hover —ç—Ñ—Ñ–µ–∫—Ç—ã –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º main_screenshot&quot;</span><span class="p">)</span>
        
        <span class="c1"># –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫—É—Ä—Å–æ—Ä –º—ã—à–∏ –≤ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ (–ª–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;document.body.style.cursor = &#39;none&#39;;&quot;</span><span class="p">)</span>  <span class="c1"># –°–∫—Ä—ã–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä</span>
            <span class="c1"># –ü–µ—Ä–µ–º–µ—â–∞–µ–º –º—ã—à—å –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ (–ª–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª)</span>
            <span class="n">actions</span> <span class="o">=</span> <span class="n">ActionChains</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
            <span class="n">actions</span><span class="o">.</span><span class="n">move_to_element_with_offset</span><span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">actions</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
            
            <span class="c1"># –ñ–¥–µ–º –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –≤—Å–µ—Ö tooltips –∏ hover —ç—Ñ—Ñ–µ–∫—Ç–æ–≤</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="c1"># –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —É–±–∏—Ä–∞–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ JavaScript</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                // –£–±–∏—Ä–∞–µ–º focus —Å –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤</span>
<span class="s2">                if (document.activeElement) {</span>
<span class="s2">                    document.activeElement.blur();</span>
<span class="s2">                }</span>
<span class="s2">                </span>
<span class="s2">                // –£–±–∏—Ä–∞–µ–º –≤—Å–µ hover —Å–æ—Å—Ç–æ—è–Ω–∏—è</span>
<span class="s2">                const hoverElements = document.querySelectorAll(&#39;:hover&#39;);</span>
<span class="s2">                hoverElements.forEach(el =&gt; {</span>
<span class="s2">                    el.style.pointerEvents = &#39;none&#39;;</span>
<span class="s2">                    setTimeout(() =&gt; {</span>
<span class="s2">                        el.style.pointerEvents = &#39;&#39;;</span>
<span class="s2">                    }, 100);</span>
<span class="s2">                });</span>
<span class="s2">                </span>
<span class="s2">                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ tooltips</span>
<span class="s2">                const tooltips = document.querySelectorAll(&#39;[role=&quot;tooltip&quot;], .tooltip, .popover&#39;);</span>
<span class="s2">                tooltips.forEach(tooltip =&gt; {</span>
<span class="s2">                    tooltip.style.display = &#39;none&#39;;</span>
<span class="s2">                });</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
            
            <span class="c1"># –ï—â—ë –æ–¥–Ω–∞ –Ω–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">hover_error</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞—Ç—å hover —ç—Ñ—Ñ–µ–∫—Ç—ã: </span><span class="si">{</span><span class="n">hover_error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–∞—É–∑–∞ –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ</span>
        
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">main_screenshot_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">svg</span><span class="o">.</span><span class="n">screenshot</span><span class="p">(</span><span class="n">main_screenshot_path</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω: </span><span class="si">{</span><span class="n">main_screenshot_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;document.body.style.cursor = &#39;&#39;;&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="c1"># Main SVG —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω —Å–±–æ—Ä SVG</span>
        <span class="n">success</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">save_svg_sync</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">svg</span><span class="p">,</span> <span class="n">main_svg_path</span><span class="p">,</span> <span class="n">claim_number</span><span class="o">=</span><span class="n">claim_number</span><span class="p">,</span> <span class="n">vin</span><span class="o">=</span><span class="n">vin</span><span class="p">,</span> <span class="n">svg_collection</span><span class="o">=</span><span class="n">svg_collection</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π SVG&quot;</span><span class="p">)</span>
            <span class="n">main_svg_relative</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">svg_collection</span><span class="p">:</span>
            <span class="c1"># –ï—Å–ª–∏ —Å–±–æ—Ä SVG –æ—Ç–∫–ª—é—á–µ–Ω, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Å—Ç–æ–π –ø—É—Ç—å</span>
            <span class="n">main_svg_relative</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">main_screenshot_relative</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">main_svg_relative</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞/SVG: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></div>


<span class="c1"># –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∑–æ–Ω—ã</span>
<div class="viewcode-block" id="extract_zones">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.extract_zones">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">extract_zones</span><span class="p">(</span><span class="n">driver</span><span class="p">):</span>
    <span class="n">zones</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">zones_container</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;tree-navigation-zones-container&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">zone_containers</span> <span class="o">=</span> <span class="n">zones_container</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div.navigation-tree-zone-container&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">zone_containers</span><span class="p">:</span>
            <span class="n">zone_id</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;data-value&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">description_span</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;tree-navigation-zone-description-</span><span class="si">{</span><span class="n">zone_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">description_span</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">zones</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
                    <span class="s2">&quot;element&quot;</span><span class="p">:</span> <span class="n">description_span</span><span class="p">,</span>
                    <span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="n">zone_id</span>
                <span class="p">})</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∑–æ–Ω—ã —Å id </span><span class="si">{</span><span class="n">zone_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ò–∑–≤–ª–µ—á–µ–Ω–æ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">zones</span><span class="p">)</span><span class="si">}</span><span class="s2"> –∑–æ–Ω: </span><span class="si">{</span><span class="p">[</span><span class="n">z</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">zones</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∑–æ–Ω: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">zones</span></div>


<span class="c1"># –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–¥–Ω—É –∑–æ–Ω—É</span>
<div class="viewcode-block" id="process_zone">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.process_zone">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">process_zone</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">screenshot_dir</span><span class="p">,</span> <span class="n">svg_dir</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">claim_number</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">vin</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">svg_collection</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–¥–Ω—É –∑–æ–Ω—É, –≤–∫–ª—é—á–∞—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞, SVG –∏ –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º.</span>
<span class="sd">    max_retries: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–µ—Å—Å–∏–∏.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># –û—á–∏—â–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –æ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –∏ —Å–∏–º–≤–æ–ª–æ–≤ —Ç–∞–±—É–ª—è—Ü–∏–∏</span>
    <span class="n">clean_claim_number</span> <span class="o">=</span> <span class="n">claim_number</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">claim_number</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">clean_vin</span> <span class="o">=</span> <span class="n">vin</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">vin</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    
    <span class="n">zone_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å zone</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">zone</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">zone</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ü—Ä–æ–ø—É—â–µ–Ω–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∑–æ–Ω–∞: title=</span><span class="si">{</span><span class="n">zone</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span><span class="si">!r}</span><span class="s2">, link=</span><span class="si">{</span><span class="n">zone</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">)</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">zone_data</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–æ–Ω—ã: </span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç DEBUG process_zone –Ω–∞—á–∞–ª–æ: claim_number=&#39;</span><span class="si">{</span><span class="n">claim_number</span><span class="si">}</span><span class="s2">&#39;, vin=&#39;</span><span class="si">{</span><span class="n">vin</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç DEBUG process_zone –æ—á–∏—â–µ–Ω–Ω—ã–µ: clean_claim_number=&#39;</span><span class="si">{</span><span class="n">clean_claim_number</span><span class="si">}</span><span class="s2">&#39;, clean_vin=&#39;</span><span class="si">{</span><span class="n">clean_vin</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">zone_element</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;tree-navigation-zone-description-</span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">zone_element</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ö–ª–∏–∫ –ø–æ –∑–æ–Ω–µ: </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="k">break</span>
        <span class="k">except</span> <span class="n">WebDriverException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –ø–æ –∑–æ–Ω–µ </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (–ø–æ–ø—ã—Ç–∫–∞ </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ù–µ —É–¥–∞–ª–æ—Å—å –∫–ª–∏–∫–Ω—É—Ç—å –ø–æ –∑–æ–Ω–µ </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> –ø–æ—Å–ª–µ </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> –ø–æ–ø—ã—Ç–æ–∫&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">zone_data</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># –§–æ—Ä–º–∏—Ä—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–º—è –¥–ª—è zone[&#39;title&#39;]</span>
    <span class="n">safe_zone_title</span> <span class="o">=</span> <span class="n">translit</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\w\s-]&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                               <span class="s1">&#39;ru&#39;</span><span class="p">,</span> <span class="nb">reversed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">safe_zone_title</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\.+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">safe_zone_title</span><span class="p">)</span>
    <span class="n">zone_screenshot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">screenshot_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;zone_</span><span class="si">{</span><span class="n">safe_zone_title</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
    <span class="n">zone_screenshot_relative</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/static/screenshots/</span><span class="si">{</span><span class="n">clean_claim_number</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">clean_vin</span><span class="si">}</span><span class="s2">/zone_</span><span class="si">{</span><span class="n">safe_zone_title</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
    <span class="n">zone_svg_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">svg_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;zone_</span><span class="si">{</span><span class="n">safe_zone_title</span><span class="si">}</span><span class="s2">.svg&quot;</span><span class="p">)</span>
    <span class="n">zone_svg_relative</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/static/svgs/</span><span class="si">{</span><span class="n">clean_claim_number</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">clean_vin</span><span class="si">}</span><span class="s2">/zone_</span><span class="si">{</span><span class="n">safe_zone_title</span><span class="si">}</span><span class="s2">.svg&quot;</span><span class="p">)</span>

    <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º —Å –Ω–∞–¥–µ–∂–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ –æ–∂–∏–¥–∞–Ω–∏—è</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># –≠—Ç–∞–ø 1: –î–æ–∂–∏–¥–∞–µ–º—Å—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã  </span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">wait_for_document_ready</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ –î–æ–∫—É–º–µ–Ω—Ç –≥–æ—Ç–æ–≤ –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># –≠—Ç–∞–ø 2: –ù–∞—Ö–æ–¥–∏–º main —ç–ª–µ–º–µ–Ω—Ç —Å retry –ª–æ–≥–∏–∫–æ–π</span>
        <span class="n">main_element</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">main_element</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                    <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;main&quot;</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ü–æ–ø—ã—Ç–∫–∞ </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: main –Ω–µ –Ω–∞–π–¥–µ–Ω, –∂–¥–µ–º...&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ main —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ø—ã—Ç–æ–∫&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">main_element</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TimeoutException</span><span class="p">(</span><span class="s2">&quot;Main —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫&quot;</span><span class="p">)</span>
        
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ Main —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># –≠—Ç–∞–ø 3: –î–æ–∂–∏–¥–∞–µ–º—Å—è pictograms-grid —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">wait_for_pictograms_grid</span><span class="p">)</span>
        <span class="n">pictograms_grid</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;main div.pictograms-grid.visible&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ –ó–æ–Ω–∞ </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º—ã&quot;</span><span class="p">)</span>
        
        <span class="c1"># –≠—Ç–∞–ø 4: –î–æ–∂–∏–¥–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π —Å —Å–æ—Å—Ç–∞–≤–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">wait_for_all_sections_loaded</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ –í—Å–µ —Å–µ–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># –≠—Ç–∞–ø 5: –î–æ–∂–∏–¥–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∫–∏ SVG —Å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">wait_for_all_svgs_ready</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ SVG —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># –≠—Ç–∞–ø 6: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å DOM (–∏–∑–±–µ–≥–∞–µ–º race conditions)</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">wait_for_dom_stability</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ DOM —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–∞—É–∑–∞ –¥–ª—è –ø–æ–ª–Ω–æ–π —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># –ö–ª–∏–∫–∞–µ–º –ø–æ #breadcrumb-sheet-title, —Å–æ–±–∏—Ä–∞–µ–º –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º—ã, –¥–µ–ª–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç, –∑–∞—Ç–µ–º –≤—Ç–æ—Ä–æ–π –∫–ª–∏–∫</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">breadcrumb_selector</span> <span class="o">=</span> <span class="s2">&quot;#breadcrumb-sheet-title&quot;</span>
            <span class="c1"># –ü–µ—Ä–≤—ã–π –∫–ª–∏–∫ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é</span>
            <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="n">breadcrumb_selector</span><span class="p">))</span>
            <span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ö–ª–∏–∫ –ø–æ </span><span class="si">{</span><span class="n">breadcrumb_selector</span><span class="si">}</span><span class="s2"> –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é –≤ –∑–æ–Ω–µ </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–∞–∂–¥–æ–π —Å–µ–∫—Ü–∏–∏ –∏ —Å–∫–ª–µ–∏–≤–∞–µ–º –≤ –ø–∞–º—è—Ç–∏</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">zone_screenshot_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏</span>
                <span class="n">sections</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                    <span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_all_elements_located</span><span class="p">((</span>
                        <span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span>
                        <span class="s2">&quot;main div.pictograms-grid.visible section.pictogram-section&quot;</span>
                    <span class="p">))</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ù–∞–π–¥–µ–Ω–æ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span><span class="si">}</span><span class="s2"> —Å–µ–∫—Ü–∏–π –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># –°–ø–∏—Å–æ–∫ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –ø–∞–º—è—Ç–∏</span>
                <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–∞–∂–¥–æ–π —Å–µ–∫—Ü–∏–∏</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">section</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sections</span><span class="p">):</span>
                    <span class="c1"># –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Å–µ–∫—Ü–∏–∏</span>
                    <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].scrollIntoView(true);&quot;</span><span class="p">,</span> <span class="n">section</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># –ü–∞—É–∑–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏</span>

                    <span class="c1"># –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã —Å–µ–∫—Ü–∏–∏</span>
                    <span class="n">section_width</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;return arguments[0].scrollWidth&quot;</span><span class="p">,</span> <span class="n">section</span><span class="p">)</span>
                    <span class="n">section_height</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;return arguments[0].offsetHeight&quot;</span><span class="p">,</span> <span class="n">section</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–°–µ–∫—Ü–∏—è </span><span class="si">{</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">section_width</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">section_height</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –≤ –ø–∞–º—è—Ç–∏</span>
                    <span class="n">screenshot_png</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">screenshot_as_png</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">screenshot_png</span><span class="p">))</span>
                    <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–°–∫—Ä–∏–Ω—à–æ—Ç —Å–µ–∫—Ü–∏–∏ </span><span class="si">{</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> –∑–∞—Ö–≤–∞—á–µ–Ω –≤ –ø–∞–º—è—Ç–∏&quot;</span><span class="p">)</span>

                <span class="c1"># –°–∫–ª–µ–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>
                <span class="n">max_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">width</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">images</span><span class="p">)</span>
                <span class="n">total_height</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">height</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">images</span><span class="p">)</span>

                <span class="c1"># –°–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</span>
                <span class="n">final_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">max_width</span><span class="p">,</span> <span class="n">total_height</span><span class="p">))</span>
                <span class="n">y_offset</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
                    <span class="n">final_image</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_offset</span><span class="p">))</span>
                    <span class="n">y_offset</span> <span class="o">+=</span> <span class="n">img</span><span class="o">.</span><span class="n">height</span>

                <span class="c1"># –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Ç–æ–≥–æ–≤—ã–π —Å–∫—Ä–∏–Ω—à–æ—Ç</span>
                <span class="n">final_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">zone_screenshot_path</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">85</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–°–∫—Ä–∏–Ω—à–æ—Ç –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> —Å–æ—Ö—Ä–∞–Ω—ë–Ω: </span><span class="si">{</span><span class="n">zone_screenshot_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># –ó–∞–∫—Ä—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>
                <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
                    <span class="n">img</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="c1"># –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –æ–∫–Ω–∞</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">driver</span><span class="o">.</span><span class="n">set_window_size</span><span class="p">(</span><span class="n">original_size</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">],</span> <span class="n">original_size</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;original_size –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

            <span class="k">except</span> <span class="p">(</span><span class="n">TimeoutException</span><span class="p">,</span> <span class="n">WebDriverException</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ù–µ —É–¥–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç —Å–µ–∫—Ü–∏–π –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">zone_screenshot_relative</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Å—Ç–æ–π –ø—É—Ç—å –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: —Å–∫—Ä–∏–Ω—à–æ—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω&quot;</span><span class="p">)</span>

            <span class="c1"># –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º, –ø–µ—Ä–µ–¥–∞–µ–º zone_screenshot_relative</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç DEBUG process_zone –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º process_pictograms: claim_number=&#39;</span><span class="si">{</span><span class="n">claim_number</span><span class="si">}</span><span class="s2">&#39;, vin=&#39;</span><span class="si">{</span><span class="n">vin</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="n">zone_data</span> <span class="o">=</span> <span class="n">process_pictograms</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">screenshot_dir</span><span class="p">,</span> <span class="n">svg_dir</span><span class="p">,</span> <span class="n">max_retries</span><span class="p">,</span> <span class="n">zone_screenshot_relative</span><span class="p">,</span> <span class="n">claim_number</span><span class="o">=</span><span class="n">claim_number</span><span class="p">,</span> <span class="n">vin</span><span class="o">=</span><span class="n">vin</span><span class="p">,</span> <span class="n">svg_collection</span><span class="o">=</span><span class="n">svg_collection</span><span class="p">)</span>

            <span class="c1"># –í—Ç–æ—Ä–æ–π –∫–ª–∏–∫ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –º–µ–Ω—é –∑–æ–Ω</span>
            <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="n">breadcrumb_selector</span><span class="p">))</span>
            <span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ö–ª–∏–∫ –ø–æ </span><span class="si">{</span><span class="n">breadcrumb_selector</span><span class="si">}</span><span class="s2"> –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –º–µ–Ω—é –∑–æ–Ω –≤ –∑–æ–Ω–µ </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># –î–æ–∂–∏–¥–∞–µ–º—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑–æ–Ω</span>
            <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;tree-navigation-zones-container&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç —Å–ª–µ–¥—É—é—â–µ–π –∑–æ–Ω—ã –¥–æ—Å—Ç—É–ø–µ–Ω</span>
            <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;tree-navigation-zone-description-</span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ú–µ–Ω—é –∑–æ–Ω –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, –≥–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∑–æ–Ω–µ&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">zone_data</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">TimeoutException</span><span class="p">,</span> <span class="n">WebDriverException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –ø–æ </span><span class="si">{</span><span class="n">breadcrumb_selector</span><span class="si">}</span><span class="s2"> –∏–ª–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># –ü—ã—Ç–∞–µ–º—Å—è –≤–µ—Ä–Ω—É—Ç—å –º–µ–Ω—é –∑–æ–Ω</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                    <span class="n">EC</span><span class="o">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="n">breadcrumb_selector</span><span class="p">))</span>
                <span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
                <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                    <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;tree-navigation-zones-container&quot;</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –º–µ–Ω—é –∑–æ–Ω –¥–ª—è </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–µ–Ω—é –∑–æ–Ω: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">zone_data</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">TimeoutException</span><span class="p">,</span> <span class="n">WebDriverException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ó–æ–Ω–∞ </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º –∏–ª–∏ –æ–Ω–∏ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ SVG</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">sheet_div</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sheet_</span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;#sheet_</span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> svg&quot;</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">svg</span> <span class="o">=</span> <span class="n">sheet_div</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">)</span>
        <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ SVG —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;return arguments[0].querySelectorAll(&#39;path, rect, circle&#39;).length&quot;</span><span class="p">,</span> <span class="n">svg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ù–∞–π–¥–µ–Ω SVG –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –∏ SVG –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ SVG</span>
                <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;arguments[0].scrollIntoView(true);&quot;</span><span class="p">,</span> <span class="n">svg</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># –ü–∞—É–∑–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏</span>
                <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã SVG</span>
                <span class="n">svg_width</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;return arguments[0].scrollWidth&quot;</span><span class="p">,</span> <span class="n">svg</span><span class="p">)</span>
                <span class="n">svg_height</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;return arguments[0].scrollHeight&quot;</span><span class="p">,</span> <span class="n">svg</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SVG –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">svg_width</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">svg_height</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">svg</span><span class="o">.</span><span class="n">screenshot</span><span class="p">(</span><span class="n">zone_screenshot_path</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–°–∫—Ä–∏–Ω—à–æ—Ç SVG –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> —Å–æ—Ö—Ä–∞–Ω—ë–Ω: </span><span class="si">{</span><span class="n">zone_screenshot_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">WebDriverException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç SVG –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">zone_screenshot_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># –ó–∞–≥–ª—É—à–∫–∞</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: —Å–∫—Ä–∏–Ω—à–æ—Ç SVG –Ω–µ —Å–æ–∑–¥–∞–Ω&quot;</span><span class="p">)</span>
                <span class="n">zone_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;screenshot_path&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;has_pictograms&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;graphics_not_available&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">[]</span>
                <span class="p">})</span>
                <span class="k">return</span> <span class="n">zone_data</span>

            <span class="c1"># –í—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º SVG –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª—ã —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º —Ñ–ª–∞–≥–µ</span>
            <span class="n">detail_paths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">success</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">detail_paths</span> <span class="o">=</span> <span class="n">save_svg_sync</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">svg</span><span class="p">,</span> <span class="n">zone_svg_path</span><span class="p">,</span> <span class="n">claim_number</span><span class="o">=</span><span class="n">claim_number</span><span class="p">,</span> <span class="n">vin</span><span class="o">=</span><span class="n">vin</span><span class="p">,</span> <span class="n">svg_collection</span><span class="o">=</span><span class="n">svg_collection</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç –ü–æ—Å–ª–µ save_svg_sync –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: success=</span><span class="si">{</span><span class="n">success</span><span class="si">}</span><span class="s2">, –ø–æ–ª—É—á–µ–Ω–æ –¥–µ—Ç–∞–ª–µ–π: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">detail_paths</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å SVG –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">zone_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;screenshot_path&quot;</span><span class="p">:</span> <span class="n">zone_screenshot_relative</span><span class="p">,</span>
                    <span class="s2">&quot;has_pictograms&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;graphics_not_available&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">[]</span>
                <span class="p">})</span>
                <span class="k">return</span> <span class="n">zone_data</span>
            
            <span class="c1"># –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Ç—å –∫ SVG —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–±–æ—Ä –≤–∫–ª—é—á—ë–Ω</span>
            <span class="k">if</span> <span class="n">svg_collection</span><span class="p">:</span>
                <span class="n">zone_svg_relative</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/static/svgs/</span><span class="si">{</span><span class="n">claim_number</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">vin</span><span class="si">}</span><span class="s2">/zone_</span><span class="si">{</span><span class="n">safe_zone_title</span><span class="si">}</span><span class="s2">.svg&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zone_svg_relative</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="n">zone_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>
                <span class="s2">&quot;screenshot_path&quot;</span><span class="p">:</span> <span class="n">zone_screenshot_relative</span><span class="p">,</span>
                <span class="s2">&quot;svg_path&quot;</span><span class="p">:</span> <span class="n">zone_svg_relative</span><span class="p">,</span>
                <span class="s2">&quot;has_pictograms&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;graphics_not_available&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="n">detail_paths</span>
            <span class="p">})</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">detail_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> –¥–µ—Ç–∞–ª–µ–π –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">WebDriverException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ SVG –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">zone_screenshot_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># –ó–∞–≥–ª—É—à–∫–∞</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: —Å–∫—Ä–∏–Ω—à–æ—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω&quot;</span><span class="p">)</span>
            <span class="n">zone_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>
                <span class="s2">&quot;screenshot_path&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;has_pictograms&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;graphics_not_available&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">[]</span>
            <span class="p">})</span>
            <span class="k">return</span> <span class="n">zone_data</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">TimeoutException</span><span class="p">,</span> <span class="n">WebDriverException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ SVG –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">zone_screenshot_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># –ó–∞–≥–ª—É—à–∫–∞</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: —Å–∫—Ä–∏–Ω—à–æ—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω&quot;</span><span class="p">)</span>
        <span class="n">zone_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>
            <span class="s2">&quot;screenshot_path&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;has_pictograms&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;graphics_not_available&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="n">zone_data</span>

    <span class="k">return</span> <span class="n">zone_data</span></div>


<span class="c1"># –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –¥–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –∑–æ–Ω</span>
<div class="viewcode-block" id="ensure_zone_details_extracted">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.ensure_zone_details_extracted">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">ensure_zone_details_extracted</span><span class="p">(</span><span class="n">zone_data</span><span class="p">,</span> <span class="n">svg_dir</span><span class="p">,</span> <span class="n">claim_number</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">vin</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">svg_collection</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–æ–Ω—ã –≤ zone_data –∏ –¥–æ–∑–∞–ø–æ–ª–Ω—è–µ—Ç –¥–µ—Ç–∞–ª–∏ –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.</span>
<span class="sd">    –ì–ê–†–ê–ù–¢–ò–†–£–ï–¢ —á—Ç–æ –≤—Å–µ –∑–æ–Ω—ã –∏–º–µ—é—Ç –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîß –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª–Ω–æ—Ç—É –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –¥–ª—è </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">zone_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> –∑–æ–Ω&quot;</span><span class="p">)</span>

    <span class="n">zones_fixed</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="n">zone_data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">zone</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;has_pictograms&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="c1"># –ü–∏–∫—Ç–æ–≥—Ä–∞–º–º—ã –Ω–µ –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–µ—Ç–∞–ª–µ–π</span>
            <span class="k">continue</span>

        <span class="n">zone_title</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">current_details</span> <span class="o">=</span> <span class="n">zone</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;details&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_details</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï: –ó–æ–Ω–∞ &#39;</span><span class="si">{</span><span class="n">zone_title</span><span class="si">}</span><span class="s2">&#39; –Ω–µ –∏–º–µ–µ—Ç –¥–µ—Ç–∞–ª–µ–π - –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ&quot;</span><span class="p">)</span>

            <span class="c1"># –ò—â–µ–º SVG —Ñ–∞–π–ª –∑–æ–Ω—ã –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏</span>
            <span class="n">zone_svg_path</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># –°–ø–æ—Å–æ–± 1: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏</span>
            <span class="n">safe_zone_title</span> <span class="o">=</span> <span class="n">translit</span><span class="p">(</span>
                <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\w\s-]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">zone_title</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                <span class="s1">&#39;ru&#39;</span><span class="p">,</span> <span class="nb">reversed</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">safe_zone_title</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\.+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">safe_zone_title</span><span class="p">)</span>
            <span class="n">candidate_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">svg_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;zone_</span><span class="si">{</span><span class="n">safe_zone_title</span><span class="si">}</span><span class="s2">.svg&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">candidate_path</span><span class="p">):</span>
                <span class="n">zone_svg_path</span> <span class="o">=</span> <span class="n">candidate_path</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ –ù–∞–π–¥–µ–Ω SVG —Ñ–∞–π–ª –∑–æ–Ω—ã (—Å–ø–æ—Å–æ–± 1): </span><span class="si">{</span><span class="n">zone_svg_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># –°–ø–æ—Å–æ–± 2: –ø–æ–∏—Å–∫ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –∑–æ–Ω –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç –ò—â–µ–º —Ñ–∞–π–ª—ã –∑–æ–Ω –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: </span><span class="si">{</span><span class="n">svg_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">svg_dir</span><span class="p">):</span>
                    <span class="n">all_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">svg_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.svg&#39;</span><span class="p">)]</span>
                    <span class="n">zone_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_files</span> <span class="k">if</span> <span class="n">is_zone_file</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç –ù–∞–π–¥–µ–Ω–æ —Ñ–∞–π–ª–æ–≤ –∑–æ–Ω: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">zone_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> –∏–∑ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> SVG —Ñ–∞–π–ª–æ–≤&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">zone_files</span><span class="p">:</span>
                        <span class="c1"># –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π –Ω–∞–π–¥–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –∑–æ–Ω—ã</span>
                        <span class="n">zone_svg_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">svg_dir</span><span class="p">,</span> <span class="n">zone_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É—é –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π —Ñ–∞–π–ª –∑–æ–Ω—ã: </span><span class="si">{</span><span class="n">zone_svg_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                        <span class="c1"># –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∑–æ–Ω –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç –í—Å–µ —Ñ–∞–π–ª—ã –∑–æ–Ω –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">zf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zone_files</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">zf</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è SVG –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: </span><span class="si">{</span><span class="n">svg_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">zone_svg_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">zone_svg_path</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üéØ –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –∏–∑–≤–ª–µ–∫–∞–µ–º –¥–µ—Ç–∞–ª–∏ –∏–∑: </span><span class="si">{</span><span class="n">zone_svg_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># –õ–æ–≥–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</span>
                    <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">zone_svg_path</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìä –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –∑–æ–Ω—ã: </span><span class="si">{</span><span class="n">file_size</span><span class="si">}</span><span class="s2"> –±–∞–π—Ç&quot;</span><span class="p">)</span>

                    <span class="n">extracted_details</span> <span class="o">=</span> <span class="n">split_svg_by_details</span><span class="p">(</span>
                        <span class="n">zone_svg_path</span><span class="p">,</span> <span class="n">svg_dir</span><span class="p">,</span>
                        <span class="n">claim_number</span><span class="o">=</span><span class="n">claim_number</span><span class="p">,</span>
                        <span class="n">vin</span><span class="o">=</span><span class="n">vin</span><span class="p">,</span>
                        <span class="n">svg_collection</span><span class="o">=</span><span class="n">svg_collection</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="n">extracted_details</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">extracted_details</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">zone</span><span class="p">[</span><span class="s2">&quot;details&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extracted_details</span>
                        <span class="n">zones_fixed</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ –£–°–ü–ï–•: –ó–æ–Ω–∞ &#39;</span><span class="si">{</span><span class="n">zone_title</span><span class="si">}</span><span class="s2">&#39; –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞: –¥–æ–±–∞–≤–ª–µ–Ω–æ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">extracted_details</span><span class="p">)</span><span class="si">}</span><span class="s2"> –¥–µ—Ç–∞–ª–µ–π&quot;</span><span class="p">)</span>

                        <span class="c1"># –õ–æ–≥–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ—Ç–∞–ª–µ–π –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">detail</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">extracted_details</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. &#39;</span><span class="si">{</span><span class="n">detail</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extracted_details</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ... –∏ –µ—â–µ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">extracted_details</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="si">}</span><span class="s2"> –¥–µ—Ç–∞–ª–µ–π&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –ü–†–û–í–ê–õ: –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å –¥–µ—Ç–∞–ª–∏ –∏–∑ </span><span class="si">{</span><span class="n">zone_svg_path</span><span class="si">}</span><span class="s2"> –¥–ª—è –∑–æ–Ω—ã &#39;</span><span class="si">{</span><span class="n">zone_title</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –≤—Ä—É—á–Ω—É—é&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –ò–°–ö–õ–Æ–ß–ï–ù–ò–ï –ø—Ä–∏ –¥–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –¥–µ—Ç–∞–ª–µ–π –∑–æ–Ω—ã &#39;</span><span class="si">{</span><span class="n">zone_title</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå Traceback: </span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –ö–†–ò–¢–ò–ß–ù–û: SVG —Ñ–∞–π–ª –∑–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è &#39;</span><span class="si">{</span><span class="n">zone_title</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –û–∂–∏–¥–∞–µ–º—ã–π –ø—É—Ç—å: </span><span class="si">{</span><span class="n">candidate_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">svg_dir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">svg_dir</span><span class="p">):</span>
                    <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">svg_dir</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚ùå –§–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏: </span><span class="si">{</span><span class="n">files</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}{</span><span class="s1">&#39;...&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢ –¥–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ </span><span class="si">{</span><span class="n">zones_fixed</span><span class="si">}</span><span class="s2"> –∑–æ–Ω –∏–∑ &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">([</span><span class="n">z</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">zone_data</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">z</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;has_pictograms&#39;</span><span class="p">,</span><span class="w"> </span><span class="kc">False</span><span class="p">)])</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">zone_data</span></div>


<span class="c1"># –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º—ã –≤ –∑–æ–Ω–µ</span>
<div class="viewcode-block" id="process_pictograms">
<a class="viewcode-back" href="../../../modules/parser.html#core.parser.visual_processor.process_pictograms">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">process_pictograms</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">screenshot_dir</span><span class="p">,</span> <span class="n">svg_dir</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zone_screenshot_relative</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">claim_number</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">vin</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">svg_collection</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –°–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º–∞—Ö –≤ –∑–æ–Ω–µ, —Å–æ—Ö—Ä–∞–Ω—è—è SVG –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–∞–±–æ—Ç—ã.</span>
<span class="sd">    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —É–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pictogram_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üé® –ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç DEBUG process_pictograms: claim_number=&#39;</span><span class="si">{</span><span class="n">claim_number</span><span class="si">}</span><span class="s2">&#39;, vin=&#39;</span><span class="si">{</span><span class="n">vin</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        
        <span class="c1"># –≠—Ç–∞–ø 1: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">ensure_document_ready</span><span class="p">)</span>
        
                <span class="c1"># –≠—Ç–∞–ø 2: –ù–∞—Ö–æ–¥–∏–º main —Å –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é</span>
        <span class="n">main</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">main</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;main&quot;</span><span class="p">))</span>
        <span class="p">)</span>
                <span class="k">if</span> <span class="n">main</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">():</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Main –Ω–∞–π–¥–µ–Ω –Ω–æ –Ω–µ –≤–∏–¥–∏–º, –ø–æ–ø—ã—Ç–∫–∞ </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ü–æ–ø—ã—Ç–∫–∞ </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: main –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–≤—Ç–æ—Ä—è–µ–º...&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">main</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">main</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Main —ç–ª–µ–º–µ–Ω—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pictogram_data</span>
        
        <span class="c1"># –≠—Ç–∞–ø 3: –ò—â–µ–º pictograms-grid —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">find_pictograms_grid_reliable</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">grid_div</span> <span class="o">=</span> <span class="n">find_pictograms_grid_reliable</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">grid_div</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ù–µ –Ω–∞–π–¥–µ–Ω –∞–∫—Ç–∏–≤–Ω—ã–π pictograms-grid –≤ –∑–æ–Ω–µ </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pictogram_data</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‚úÖ –ù–∞–π–¥–µ–Ω pictograms-grid –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># –≠—Ç–∞–ø 4: –°–æ–±–∏—Ä–∞–µ–º —Å–µ–∫—Ü–∏–∏ —Å –Ω–∞–¥–µ–∂–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">wait_for_sections_stability</span><span class="p">)</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="n">grid_div</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;section&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üéØ –ù–∞–π–¥–µ–Ω–æ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span><span class="si">}</span><span class="s2"> —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Å–µ–∫—Ü–∏–π –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º&quot;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">section_idx</span><span class="p">,</span> <span class="n">section</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sections</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Å–µ–∫—Ü–∏–∏</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">section</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">():</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–°–µ–∫—Ü–∏—è </span><span class="si">{</span><span class="n">section_idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> –Ω–µ –≤–∏–¥–∏–º–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># –ù–∞—Ö–æ–¥–∏–º h2 —Å –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π</span>
                <span class="n">h2_elements</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;h2.sort-title.visible&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">h2_elements</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ù–µ –Ω–∞–π–¥–µ–Ω h2.sort-title.visible –≤ —Å–µ–∫—Ü–∏–∏ </span><span class="si">{</span><span class="n">section_idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                
                <span class="n">h2</span> <span class="o">=</span> <span class="n">h2_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">section_name</span> <span class="o">=</span> <span class="n">h2</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">section_name</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ü—É—Å—Ç–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ </span><span class="si">{</span><span class="n">section_idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> –≤ –∑–æ–Ω–µ </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># –ù–∞—Ö–æ–¥–∏–º holder —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π</span>
                <span class="n">holders</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;pictograms-grid-holder&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">holders</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ù–µ –Ω–∞–π–¥–µ–Ω pictograms-grid-holder –≤ —Å–µ–∫—Ü–∏–∏ &#39;</span><span class="si">{</span><span class="n">section_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="n">holder</span> <span class="o">=</span> <span class="n">holders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">holder</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">():</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Holder –Ω–µ –≤–∏–¥–∏–º –≤ —Å–µ–∫—Ü–∏–∏ &#39;</span><span class="si">{</span><span class="n">section_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="c1"># –≠—Ç–∞–ø 5: –°–æ–±–∏—Ä–∞–µ–º —Ä–∞–±–æ—Ç—ã —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é</span>
                <span class="n">works</span> <span class="o">=</span> <span class="p">[]</span>
                
                <span class="c1"># –î–æ–∂–∏–¥–∞–µ–º—Å—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç –≤ —Å–µ–∫—Ü–∏–∏</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">wait_for_works_in_section</span><span class="p">(</span><span class="n">holder</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–¢–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è —Ä–∞–±–æ—Ç –≤ —Å–µ–∫—Ü–∏–∏ &#39;</span><span class="si">{</span><span class="n">section_name</span><span class="si">}</span><span class="s2">&#39;, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏&quot;</span><span class="p">)</span>
                
                <span class="n">work_divs</span> <span class="o">=</span> <span class="p">[</span><span class="n">div</span> <span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">holder</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">)</span> 
                            <span class="k">if</span> <span class="n">div</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;data-tooltip&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">div</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">()]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîß –ù–∞–π–¥–µ–Ω–æ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">work_divs</span><span class="p">)</span><span class="si">}</span><span class="s2"> —Ä–∞–±–æ—Ç –≤ —Å–µ–∫—Ü–∏–∏ &#39;</span><span class="si">{</span><span class="n">section_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">work_idx</span><span class="p">,</span> <span class="n">work_div</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">work_divs</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">work_div</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">():</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–†–∞–±–æ—Ç–∞ </span><span class="si">{</span><span class="n">work_idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> –Ω–µ –≤–∏–¥–∏–º–∞ –≤ —Å–µ–∫—Ü–∏–∏ &#39;</span><span class="si">{</span><span class="n">section_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                            <span class="k">continue</span>

                        <span class="c1"># –°–æ–±–∏—Ä–∞–µ–º work_name1 —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π</span>
                        <span class="n">work_name1</span> <span class="o">=</span> <span class="n">work_div</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;data-tooltip&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">work_name1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">work_name1</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ü—É—Å—Ç–æ–µ data-tooltip –¥–ª—è —Ä–∞–±–æ—Ç—ã </span><span class="si">{</span><span class="n">work_idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> –≤ —Å–µ–∫—Ü–∏–∏ &#39;</span><span class="si">{</span><span class="n">section_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                            <span class="k">continue</span>
                        <span class="n">work_name1</span> <span class="o">=</span> <span class="n">work_name1</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                        <span class="c1"># –°–æ–±–∏—Ä–∞–µ–º work_name2 —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π</span>
                        <span class="n">work_name2</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">spans</span> <span class="o">=</span> <span class="n">work_div</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;span &gt; span&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">spans</span><span class="p">:</span>
                            <span class="n">work_name2</span> <span class="o">=</span> <span class="n">spans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                        <span class="c1"># –ù–∞—Ö–æ–¥–∏–º SVG –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π</span>
                        <span class="n">svg_containers</span> <span class="o">=</span> <span class="n">work_div</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s2">&quot;div.navigation-pictogram-svg-container&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">svg_containers</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ù–µ –Ω–∞–π–¥–µ–Ω SVG –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã &#39;</span><span class="si">{</span><span class="n">work_name1</span><span class="si">}</span><span class="s2">&#39; –≤ —Å–µ–∫—Ü–∏–∏ &#39;</span><span class="si">{</span><span class="n">section_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                            <span class="k">continue</span>

                        <span class="n">svg_container</span> <span class="o">=</span> <span class="n">svg_containers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">svg_container</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">():</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SVG –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –≤–∏–¥–∏–º –¥–ª—è —Ä–∞–±–æ—Ç—ã &#39;</span><span class="si">{</span><span class="n">work_name1</span><span class="si">}</span><span class="s2">&#39; –≤ —Å–µ–∫—Ü–∏–∏ &#39;</span><span class="si">{</span><span class="n">section_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                            <span class="k">continue</span>

                        <span class="c1"># –°–æ–±–∏—Ä–∞–µ–º SVG —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –æ–∂–∏–¥–∞–Ω–∏–µ–º</span>
                        <span class="n">svgs</span> <span class="o">=</span> <span class="n">svg_container</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">svgs</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SVG –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã &#39;</span><span class="si">{</span><span class="n">work_name1</span><span class="si">}</span><span class="s2">&#39; –≤ —Å–µ–∫—Ü–∏–∏ &#39;</span><span class="si">{</span><span class="n">section_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                            <span class="k">continue</span>
                        
                        <span class="n">svg</span> <span class="o">=</span> <span class="n">svgs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        
                        <span class="c1"># –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å SVG —Å —Ç–∞–π–º–∞—É—Ç–æ–º</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                                <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">svg</span><span class="o">.</span><span class="n">is_displayed</span><span class="p">()</span> <span class="ow">and</span> 
                                <span class="n">d</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">&quot;return arguments[0].querySelectorAll(&#39;path, rect, circle, g&#39;).length &gt; 0&quot;</span><span class="p">,</span> <span class="n">svg</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SVG –Ω–µ –≥–æ—Ç–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã &#39;</span><span class="si">{</span><span class="n">work_name1</span><span class="si">}</span><span class="s2">&#39; –≤ —Å–µ–∫—Ü–∏–∏ &#39;</span><span class="si">{</span><span class="n">section_name</span><span class="si">}</span><span class="s2">&#39;, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º&quot;</span><span class="p">)</span>
                            <span class="k">continue</span>

                        <span class="c1"># –§–æ—Ä–º–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞</span>
                        <span class="n">safe_section_name</span> <span class="o">=</span> <span class="n">translit</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\w\s-]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">section_name</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;ru&#39;</span><span class="p">,</span> <span class="nb">reversed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="n">safe_work_name1</span> <span class="o">=</span> <span class="n">translit</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\w\s-]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">work_name1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;ru&#39;</span><span class="p">,</span> <span class="nb">reversed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="n">safe_work_name2</span> <span class="o">=</span> <span class="n">translit</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\w\s-]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">work_name2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;ru&#39;</span><span class="p">,</span> <span class="nb">reversed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">work_name2</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">safe_work_name2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\.+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">safe_work_name2</span><span class="p">)</span>
                        <span class="n">safe_work_name1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\.+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">safe_work_name1</span><span class="p">)</span>
                        <span class="n">safe_section_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\.+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">safe_section_name</span><span class="p">)</span>
                        <span class="n">svg_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">safe_section_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">safe_work_name1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">safe_work_name2</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">work_name2</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.svg&quot;</span>
                        <span class="n">work_svg_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">svg_dir</span><span class="p">,</span> <span class="n">svg_filename</span><span class="p">)</span>
                        <span class="n">work_svg_relative</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/static/svgs/</span><span class="si">{</span><span class="n">claim_number</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">vin</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">svg_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üîç DEBUG: claim_number=&#39;</span><span class="si">{</span><span class="n">claim_number</span><span class="si">}</span><span class="s2">&#39;, vin=&#39;</span><span class="si">{</span><span class="n">vin</span><span class="si">}</span><span class="s2">&#39;, work_svg_relative=&#39;</span><span class="si">{</span><span class="n">work_svg_relative</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

                        <span class="c1"># –°–æ—Ö—Ä–∞–Ω—è–µ–º SVG —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω —Å–±–æ—Ä SVG</span>
                        <span class="k">if</span> <span class="n">svg_collection</span><span class="p">:</span>
                            <span class="n">success</span><span class="p">,</span> <span class="n">saved_path</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">save_svg_sync</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">svg</span><span class="p">,</span> <span class="n">work_svg_path</span><span class="p">,</span> <span class="n">claim_number</span><span class="o">=</span><span class="n">claim_number</span><span class="p">,</span> <span class="n">vin</span><span class="o">=</span><span class="n">vin</span><span class="p">,</span> <span class="n">svg_collection</span><span class="o">=</span><span class="n">svg_collection</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># –ï—Å–ª–∏ —Å–±–æ—Ä –æ—Ç–∫–ª—é—á–µ–Ω, —Å—á–∏—Ç–∞–µ–º —É—Å–ø–µ—à–Ω—ã–º</span>
                        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SVG –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º—ã </span><span class="si">{</span><span class="s1">&#39;—Å–æ—Ö—Ä–∞–Ω—ë–Ω&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">svg_collection</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;–ø—É—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω&#39;</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">work_svg_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">works</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                <span class="s2">&quot;work_name1&quot;</span><span class="p">:</span> <span class="n">work_name1</span><span class="p">,</span>
                                <span class="s2">&quot;work_name2&quot;</span><span class="p">:</span> <span class="n">work_name2</span><span class="p">,</span>
                                <span class="s2">&quot;svg_path&quot;</span><span class="p">:</span> <span class="n">work_svg_relative</span> <span class="k">if</span> <span class="n">svg_collection</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                            <span class="p">})</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å SVG –¥–ª—è —Ä–∞–±–æ—Ç—ã &#39;</span><span class="si">{</span><span class="n">work_name1</span><span class="si">}</span><span class="s2">&#39; –≤ —Å–µ–∫—Ü–∏–∏ &#39;</span><span class="si">{</span><span class="n">section_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                            <span class="n">works</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                <span class="s2">&quot;work_name1&quot;</span><span class="p">:</span> <span class="n">work_name1</span><span class="p">,</span>
                                <span class="s2">&quot;work_name2&quot;</span><span class="p">:</span> <span class="n">work_name2</span><span class="p">,</span>
                                <span class="s2">&quot;svg_path&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
                            <span class="p">})</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ä–∞–±–æ—Ç—ã –≤ —Å–µ–∫—Ü–∏–∏ </span><span class="si">{</span><span class="n">section_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">continue</span>

                <span class="k">if</span> <span class="n">works</span><span class="p">:</span>
                    <span class="n">pictogram_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;section_name&quot;</span><span class="p">:</span> <span class="n">section_name</span><span class="p">,</span>
                        <span class="s2">&quot;works&quot;</span><span class="p">:</span> <span class="n">works</span>
                    <span class="p">})</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–µ–∫—Ü–∏–∏ –≤ –∑–æ–Ω–µ </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

        <span class="c1"># –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–æ–Ω—ã</span>
        <span class="k">if</span> <span class="n">pictogram_data</span><span class="p">:</span>
            <span class="n">zone_entry</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">],</span>
                <span class="s2">&quot;screenshot_path&quot;</span><span class="p">:</span> <span class="n">zone_screenshot_relative</span><span class="p">,</span>  <span class="c1"># –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Ç—å –∫ —Å–∫–ª–µ–µ–Ω–Ω–æ–º—É —Å–∫—Ä–∏–Ω—à–æ—Ç—É</span>
                <span class="s2">&quot;svg_path&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;has_pictograms&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;graphics_not_available&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s2">&quot;pictograms&quot;</span><span class="p">:</span> <span class="n">pictogram_data</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">zone_entry</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–ù–µ –Ω–∞–π–¥–µ–Ω–æ –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="n">TimeoutException</span><span class="p">,</span> <span class="n">WebDriverException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º –¥–ª—è –∑–æ–Ω—ã </span><span class="si">{</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pictogram_data</span> </div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; –ê–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞ 2024. </p>
  </div>

  –°–æ–±—Ä–∞–Ω–æ –ø—Ä–∏ –ø–æ–º–æ—â–∏ <a href="https://www.sphinx-doc.org/">Sphinx</a> —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">—Ç–µ–º—ã,</a>
    –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>