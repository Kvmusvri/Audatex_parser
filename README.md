# Audotex Parser

Автоматизированный парсер системы Audatex для извлечения данных о повреждениях автомобилей.

## Архитектура проекта

### Основные файлы
* **main.py** - FastAPI приложение с веб-интерфейсом
* **core/database/** - модули работы с базой данных
* **core/parser/** - модульная система парсера (см. ниже)
* **templates/** - HTML шаблоны веб-интерфейса
* **static/** - статические файлы и результаты парсинга

### Модули парсера (`core/parser/`)

* **`constants.py`** - Константы и конфигурация проекта
* **`browser.py`** - Управление Chrome/ChromeDriver, инициализация браузера
* **`auth.py`** - Авторизация в системе Audatex, работа с cookies
* **`folder_manager.py`** - Создание папок, извлечение VIN и номеров дел
* **`output_manager.py`** - Формирование HTML-таблиц и JSON-отчетов
* **`actions.py`** - Взаимодействие с элементами интерфейса, поиск данных
* **`option_processor.py`** - Сбор и обработка опций автомобиля (см. ниже)
* **`visual_processor.py`** - Обработка SVG, скриншотов, пиктограмм
* **`parser.py`** - Координатор процесса, точка входа `login_audatex()`

#### Модуль `option_processor.py`

**Назначение:** Универсальный сбор опций автомобиля из всех зон системы Audatex с человекообразным поведением.

**Основные функции:**
* **`process_vehicle_options()`** - Главная функция обработки опций
* **`collect_all_options_extended()`** - Расширенный сбор с детальной отчетностью
* **`extract_zone_options_universal()`** - Универсальная обработка любой зоны
* **`extract_regular_options_from_container()`** - Специальная обработка regular-options секции

**Особенности:**
- **Человеческие паузы** между действиями для обхода защиты
- **Универсальные селекторы** для поиска всех типов опций (`isolated-model-option-in-group`, `model-option`, etc.)
- **Обработка всех зон** включая специальные ("Все выбранные опции", "Predefined MO")
- **Детальная диагностика** с логированием каждого этапа
- **Удаление дубликатов** и валидация данных
- **Обработка ошибок** без остановки всего процесса

**Поддерживаемые типы опций:**
- Regular options (обычные опции)
- All selected options (все выбранные опции)
- Predefined model options (предустановленные опции)
- Zone relevant options (релевантные зоне опции)
- Additional options (дополнительные опции)

### Структура данных
* **static/data/** - JSON файлы с результатами парсинга
* **static/screenshots/** - Скриншоты зон повреждений
* **static/svgs/** - SVG файлы схем автомобилей

## Инструкция по запуску

### 1. Подготовка окружения
```bash
git clone <repository>
cd Audotex_parse
pip install -r requirements.txt
```

### 2. Запуск приложения
**Windows:**
```bash
python main.py
```

**Linux:**
```bash
python3 main.py
```

### 3. Использование
1. Перейти по адресу http://127.0.0.1:8000/
2. Ввести данные учетной записи Audatex
3. Ввести **номер дела** или **VIN номер** (обязательно одно из полей)
   - Поиск в первую очередь по номеру дела
4. Дождаться завершения обработки

### 4. Результаты
- **Время обработки:** ~5 минут на заявку
- **Результат:** страница `/success` с данными
- **История:** `/history` для просмотра всех заявок

## Файлы системы

### Автоматически создаваемые файлы
* **cookies.pkl** - Сессия авторизации (создается при первом запуске)
* **static/data/[claim]_[vin]/data_[timestamp].json** - Результаты парсинга
* **static/screenshots/[claim]_[vin]/** - Скриншоты зон
* **static/svgs/[claim]_[vin]/** - SVG схемы

## Устранение неполадок

**При ошибках парсинга:**
1. Удалить файл `cookies.pkl`
2. Перезапустить приложение
3. Повторить попытку парсинга

**Требования:**
- Chrome браузер (устанавливается автоматически)
- Стабильное интернет-соединение
- Валидные учетные данные Audatex

## Технические особенности

- **Selenium** для автоматизации браузера
- **Undetected ChromeDriver** для обхода защиты
- **Модульная архитектура** для легкого сопровождения
- **Асинхронная обработка** для производительности
- **Автоматическое управление сессиями**

