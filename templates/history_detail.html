<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–∞</title>
    <link rel="stylesheet" href="/static/css/history_detail.css">
    <link rel="icon" href="data:," />
</head>
<body>
    <div class="container">
        <div class="form-wrapper">
            <h1>{{ record.vin_value or record.folder }} ({{ record.created_date or record.created }})</h1>
            
            <!-- VIN –°—Ç–∞—Ç—É—Å -->
            <div class="vin-status-field">
                <span class="vin-status-label">VIN —Å—Ç–∞—Ç—É—Å:</span>
                <span class="vin-status-value vin-status-{{ record.vin_status.lower().replace(' ', '-') if record.vin_status else '–Ω–µ—Ç' }}">
                    {{ record.vin_status or '–ù–µ—Ç' }}
                </span>
            </div>
            
            <a href="/history" class="back-button">–ù–∞–∑–∞–¥ –∫ –∏—Å—Ç–æ—Ä–∏–∏</a>
            
            <!-- –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª–∞–¥–æ–∫ -->
            <div class="tabs-container">
                <div class="tabs-header">
                    <button class="tab-button active" onclick="switchTab('svg')">SVG –∏ –°—Ö–µ–º—ã</button>
                    <button class="tab-button" onclick="switchTab('options')">–û–ø—Ü–∏–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è</button>
                </div>
                
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ SVG -->
                <div id="tab-svg" class="tab-content active">
                    <div class="content-wrapper">
                        <div class="left-column">
                            <!-- –ó–æ–Ω—ã -->
                            <div class="zones-container">
                                <h2>–ó–æ–Ω—ã</h2>
                                <!-- –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –¥–ª—è "–í—Å–µ –∑–æ–Ω—ã" -->
                                <div class="all-zones-row">
                                    <button class="all-zones-button" data-record="1">–í—Å–µ –∑–æ–Ω—ã</button>
                                    {% if record.main_svg_path and record.main_svg_path.strip() and record.main_svg_path != '' %}
                                        <a href="{{ record.main_svg_path or '' }}" download class="svg-download" title="–°–∫–∞—á–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π SVG">
                                            <span class="download-icon">‚¨á</span>
                                        </a>
                                    {% endif %}
                                </div>
                                <div class="data-table">
                                    {% for zone in record.zone_data %}
                                        <div class="table-section">
                                            <div class="item-row">
                                                {% if zone.svg_path and zone.svg_path.strip() and zone.svg_path != '' %}
                                                    <a href="{{ zone.svg_path or '' }}" download class="svg-download" title="–°–∫–∞—á–∞—Ç—å SVG">
                                                        <span class="download-icon">‚¨á</span>
                                                    </a>
                                                {% endif %}
                                                <button class="item-button zone-button" data-zone-title="{{ zone.title }}" data-record="1">
                                                    {{ zone.title }}
                                                    {% if zone.has_pictograms %}
                                                        <span class="pictogram-icon">üñºÔ∏è</span>
                                                    {% endif %}
                                                </button>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                            
                            <!-- –î–µ—Ç–∞–ª–∏ –∏ –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º—ã -->
                            <div class="sidebar wide-sidebar">
                                <h2>–î–µ—Ç–∞–ª–∏ –∏ –ø–∏–∫—Ç–æ–≥—Ä–∞–º–º—ã</h2>
                                <div class="data-table">
                                    <div id="details-list" class="details-list"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="right-column">
                            <div class="image-container">
                                <div class="screenshot-container">
                                    <img id="main-screenshot" src="{{ record.main_screenshot_path or '' }}" alt="–°–∫—Ä–∏–Ω—à–æ—Ç –∑–æ–Ω" data-original-src="{{ record.main_screenshot_path or '' }}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ –û–ø—Ü–∏–π -->
                <div id="tab-options" class="tab-content">
                    {% if record.options_data and record.options_data.success %}
                        {% if record.options_data.zones %}
                            <div class="options-summary-card">
                                <h3>–°–≤–æ–¥–∫–∞ –ø–æ –æ–ø—Ü–∏—è–º</h3>
                                <p>
                                    <strong>–í—Å–µ–≥–æ –∑–æ–Ω:</strong> {{ record.options_data.statistics.total_zones }} | 
                                    <strong>–í—Å–µ–≥–æ –æ–ø—Ü–∏–π:</strong> {{ record.options_data.statistics.total_options }} | 
                                    <strong>–í—ã–±—Ä–∞–Ω–æ:</strong> {{ record.options_data.statistics.total_selected }}
                                </p>
                            </div>
                            
                            <div class="options-data-table">
                                <div class="options-left-column">
                                    <h2>–ó–æ–Ω—ã –æ–ø—Ü–∏–π</h2>
                                    <div class="data-table">
                                        {% for zone in record.options_data.zones %}
                                            <div class="table-section">
                                                <div class="section-header" data-zone-index="{{ loop.index0 }}" data-zone-title="{{ zone.zone_title }}">
                                                    <span>{{ zone.zone_title }}</span>
                                                    <span class="section-info">{{ zone.selected_count }}/{{ zone.total_options }}</span>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                
                                <div class="options-right-column">
                                    <h2>–î–µ—Ç–∞–ª–∏ –æ–ø—Ü–∏–π</h2>
                                    <div class="options-detail-view">
                                        <div id="options-detail-content" class="no-selection-message">
                                            –í—ã–±–µ—Ä–∏—Ç–µ –∑–æ–Ω—É —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –æ–ø—Ü–∏–∏
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <div class="no-selection-message" style="text-align: center; padding: 40px; color: #6c757d;">
                                <h3>–ó–æ–Ω—ã –æ–ø—Ü–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                                <p>–î–∞–Ω–Ω—ã–µ –æ–ø—Ü–∏–π –Ω–µ –±—ã–ª–∏ —Å–æ–±—Ä–∞–Ω—ã –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è.</p>
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="no-selection-message" style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>–û–ø—Ü–∏–∏ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã</h3>
                            <p>{% if record.options_data and record.options_data.error %}{{ record.options_data.error }}{% else %}–î–∞–Ω–Ω—ã–µ –æ–ø—Ü–∏–π –Ω–µ –±—ã–ª–∏ —Å–æ–±—Ä–∞–Ω—ã –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.{% endif %}</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ JavaScript -->
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –¥–∞–Ω–Ω—ã–º–∏
        {% if record.zone_data %}
        window.zoneData = {{ record.zone_data | tojson | safe }};
        {% else %}
        window.zoneData = [];
        {% endif %}
        
        {% if record.options_data and record.options_data.zones %}
        window.optionsData = {{ record.options_data.zones | tojson | safe }};
        {% else %}
        window.optionsData = [];
        {% endif %}
    </script>
    
    <script src="/static/js/history_detail.js"></script>
</body>
</html>